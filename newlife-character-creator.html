<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newlife Character Creator</title>
    <style>
        :root {
            --primary: #3498db;
            --primary-disabled: #3498db7d;
            --secondary: #2c3e50;
            --secondary-disabled: #2c3e507d;
            --success: #27ae60;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --border: #bdc3c7;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1, h2, h3 {
            color: var(--secondary);
        }
        
        h1 {
            text-align: center;
            margin-bottom: -10px;
        }
        
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 15px;
        }
        
        .tab-button {
            padding: 10px 20px;
            background-color: var(--light);
            border: 1px solid var(--border);
            cursor: pointer;
            flex-grow: 1;
            text-align: center;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .tab-button:first-child {
            border-radius: 4px 0 0 4px;
        }
        
        .tab-button:last-child {
            border-radius: 0 4px 4px 0;
        }
        
        .tab-button.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        .form-group-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            column-gap: 20px;
            row-gap: 0;
        }

        .form-group {
            margin-bottom: 5px;
        }

        .row-divider {
            grid-column: 1 / -1;
            height: 1px;
            background-color: var(--border);
            margin-top: 15px;
            margin-bottom: 15px;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select,
        .form-group textarea {
            width: 98%;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="text"],
        input[type="search"],
        select,
        textarea {
            width: 100% !important;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            box-sizing: border-box;
        }

        .custom-file-upload {
            display: flex;
            position: relative;
        }

        .load-file-text {
            border-radius: 4px 0 0 4px !important;
        }

        .browse-button {
            padding: 3px 16px 4px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-left: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            margin: 0 !important;
        }

        input[type="file"] {
            opacity: 0;
            position: absolute;
            width: 0.1px;
            height: 0.1px;
            z-index: -1;
        }
        
        .traits-section {
            margin-top: 20px;
            grid-column: 1 / -1;
            width: 100%;
        }
        
        .traits-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
        }
        
        .trait-card {
            background-color: var(--light);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .trait-card:hover {
            background-color: #d6eaf8;
        }
        
        .trait-card.selected {
            background-color: var(--primary);
            color: white;
        }
        
        .trait-card.disabled {
            background-color: var(--secondary-disabled);
            color: rgba(255, 255, 255, 0.5); /* For text color */
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        .trait-card .tooltip {
            visibility: hidden;
            max-width: 300px;
            background-color: var(--dark);
            color: white;
            text-align: center;
            padding: 10px;
            border-radius: 4px;
            position: fixed; /* Change from absolute to fixed */
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            pointer-events: none; /* Prevents the tooltip from interfering with hover */
            white-space: pre-line;
        }
        
        .trait-card:hover .tooltip {
            visibility: visible;
            opacity: 1 !important;
        }
        
        .selected-traits {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            min-height: 40px;
            display: contents;
        }
        
        .selected-trait {
            display: inline-block;
            background-color: var(--primary);
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .selected-trait .remove {
            margin-left: 5px;
            cursor: pointer;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            grid-column: 1 / -1;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        button.primary {
            background-color: var(--primary);
            color: white;
        }
        
        button.primary:hover {
            background-color: #2980b9;
        }
        
        button.secondary {
            background-color: var(--light);
            color: var(--dark);
        }
        
        button.secondary:hover {
            background-color: #bdc3c7;
        }
        
        .output {
            margin-top: 20px;
        }
        
        textarea {
            width: 100%;
            min-height: 300px;
            font-family: monospace;
            white-space: pre;
            resize: vertical;
        }

        #back-button {
            margin-top: 10px;
        }

        .copy-button {
            margin-top: 10px;
            background-color: var(--success);
            color: white;
            float: right;
        }
        
        .copy-button:hover {
            background-color: #219653;
        }
        .download-button {
            margin-top: 10px;
            margin-left: 10px; /* Add some spacing from the copy button */
            margin-right: 10px; /* Add some spacing from the copy button */
            background-color: var(--secondary);
            color: white;
            float: right;
        }

        .download-button:hover {
            background-color: #1a2530; /* Darker version of your secondary color */
        }

        .field-info {
            margin-top: 2px;
            margin-left: 2px;
            margin-bottom: 2px;
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        
        .collapsible {
            background-color: var(--light);
            cursor: pointer;
            padding: 10px;
            width: 100%;
            text-align: left;
            border: none;
            outline: none;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .collapsible:after {
            content: '\002B';
            color: var(--dark);
            font-weight: bold;
            float: right;
        }
        
        .active-collapse:after {
            content: "\2212";
        }
        
        .collapsible-content {
            padding: 0 10px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            background-color: white;
            border-radius: 0 0 4px 4px;
        }

        #custom-race-fields {
            grid-column: 1 / -1;
        }

        .header-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 15px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary);
        }
        
        .version-dropdown {
            position: absolute;
            top: 0;
            right: 0;
            z-index: 10;
        }

        .version-dropdown select {
            font-size: 0.8rem;
            padding: 3px 6px;
            border-radius: 4px;
            border: 1px solid var(--border);
            background-color: #2c3e50; /* Dark background to match your theme */
            color: white; /* White text for dark theme */
            cursor: pointer;
        }

        .faq-section {
            margin-bottom: 25px;
        }
        
        .faq-section .collapsible {
            background-color: var(--secondary);
            color: white;
            font-weight: bold;
        }
        
        .faq-section .collapsible:after {
            color: white;
        }
        
        .faq-inner-content {
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid var(--border);
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .faq-inner-content code {
            background-color: #e9ecef;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }

        /* For mobile responsiveness */
        @media (max-width: 1024px) {
            .form-group-container {
                grid-template-columns: 1fr 1fr;
            }
        }
        @media (max-width: 768px) {
            .form-group-container {
                grid-template-columns: 1fr;
            }
        }

    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header-container">
            <h1>Newlife Character Creator</h1>
            <div class="version-dropdown">
                <select id="version-select">
                    <option value="0.8.12">Version: 0.8.12</option>
                    <option value="0.8.10">Version: 0.8.10</option>
                    <option value="0.8.9">Version: 0.8.9</option>
                    <option value="0.0.0">Version: 0.0.0</option>
                </select>
            </div>
        </div>
        
        <div class="faq-section">
            <button type="button" class="faq collapsible active-collapse">How do I load custom NPCs into Newlife?</button>
            <div class="collapsible-content" style="max-height: fit-content">
                <div class="faq-inner-content">
                    <p>To add custom NPCs to your Newlife game:</p>
                    <ol>
                        <li>Create your character using this tool and download the YAML file</li>
                        <li>Place the YAML file in the <code>newlife_gamedata/user_created_npcs</code> folder within your Newlife game directory</li>
                        <ul>
                            <li>If the folder doesn't exist, create it or load the game once and it should be created automatically</li>
                        </ul>    
                        <li>Ensure <code>Use Custom NPCs</code> is set to 'true' in the Options menu</li>
                        <li>Click on the <code>Test NPCs</code> button on the main menu to make sure your custom NPCs are valid</li>
                        <li>Start a new game - your custom NPC should appear based on their configured settings</li>
                    </ol>
                    <p><strong>Note:</strong> Custom NPCs are only loaded when starting a new game. They won't appear in games that are already in progress.</p>
                </div>
            </div>
            <button type="button" class="faq collapsible active-collapse">How do I upload custom race data settings?</button>
            <div class="collapsible-content" style="max-height: fit-content">
                <div class="faq-inner-content">
                    <p>I'll explain tomorrow... tired now... zzz...</p>
                </div>
            </div>
        </div>        

        <div class="tab-container">
            <div class="tab-buttons">
                <div class="tab-button active" data-tab="tab-create">Create Character</div>
                <div class="tab-button" data-tab="tab-output">View YAML Output</div>
            </div>
            
            <div class="tab-content active" id="tab-create">
                <div class="form-group-container">             
                    <div class="form-group">
                        <label for="raceDataText">Race Data:</label>
                        <div class="custom-file-upload">
                            <input type="text" id="raceDataText" class="load-file-text" placeholder="Using default raceData.json" inert>
                            <label id="raceDataBrowseButton" for="raceDataUpload" class="browse-button">Browse</label>
                            <label id="raceDataResetButton" class="browse-button" style="display: none">Reset</label>
                            <input type="file" id="raceDataUpload" name="raceData" accept=".json">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="loadCharacterText">Load Character:</label>
                        <div class="custom-file-upload">
                            <input type="text" id="loadCharacterText" class="load-file-text" placeholder="No character loaded" inert>
                            <label id="loadCharacterBrowseButton" for="loadCharacterUpload" class="browse-button">Browse</label>
                            <input type="file" id="loadCharacterUpload" name="loadCharacter" accept=".yml">
                        </div>
                    </div>

                    <div class="row-divider"></div>

                    <div class="form-group">
                        <label for="character-enabled">Enabled:</label>
                        <select id="character-enabled">
                            <option value="TRUE">TRUE</option>
                            <option value="FALSE">FALSE</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="namelist-id">Namelist ID:</label>
                        <select id="namelist-id">
                            <option value="">Random (based on race)</option>
                            <option value="general">general</option>
                            <option value="scottish">scottish</option>
                            <option value="irish">irish</option>
                            <option value="arabic">arabic</option>
                            <option value="turkish">turkish</option>
                            <option value="nigerian">nigerian</option>
                            <option value="swahili">swahili</option>
                            <option value="indian">indian</option>
                            <option value="chinese">chinese</option>
                            <option value="japanese">japanese</option>
                        </select>
                    </div>
                           
                    <div class="form-group">
                        <label for="character-priority">Priority:</label>
                        <input type="number" id="character-priority" style="height: 28px" value="0">
                    </div>

                    <div class="row-divider"></div>

                    <div class="form-group">
                        <label for="character-name">Name:</label>
                        <input type="text" id="character-name" placeholder="Leave blank to choose randomly from namelist">
                    </div>

                    <div class="form-group">
                        <label for="character-type">Sex:</label>
                        <select id="character-type">
                            <option value="MALE">Male</option>
                            <option value="FEMALE">Female</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="character-age">Age:</label>
                        <select id="character-age">
                            <option value="LATE_TEENS">LATE_TEENS</option>
                            <option value="EARLY_TWENTIES">EARLY_TWENTIES</option>
                            <option value="TWENTIES" selected>TWENTIES</option>
                            <option value="THIRTIES">THIRTIES</option>
                            <option value="FORTIES">FORTIES</option>
                            <option value="FIFTIES">FIFTIES</option>
                            <option value="OLD">OLD</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="character-race">Race:</label>
                        <select id="character-race">
                            <option value="">Random (based on game settings)</option>
                            <option value="east asian">east asian</option>
                            <option value="south asian">south asian</option>
                            <option value="black">black</option>
                            <option value="middle-eastern">middle-eastern</option>
                            <option value="white">white</option>
                            <option value="custom">custom (enter below)</option>
                        </select>
                    </div>
                                    
                    <div class="form-group male-only">
                        <label for="male-figure">Figure:</label>
                        <select id="male-figure">
                            <option value="">Random (influenced by age)</option>
                            <option value="SKINNY">Skinny</option>
                            <option value="AVERAGE">Average</option>
                            <option value="TONED">Toned</option>
                            <option value="MUSCULAR">Muscular</option>
                            <option value="THICKSET">Thickset</option>
                            <option value="PAUNCHY">Paunchy</option>
                            <option value="FAT">Fat</option>
                        </select>
                    </div>
                    
                    <div class="form-group female-only" style="display:none">
                        <label for="female-figure">Figure:</label>
                        <select id="female-figure">
                            <option value="">Random</option>
                            <option value="SLIM">Slim</option>
                            <option value="TONED">Toned</option>
                            <option value="WOMANLY">Womanly</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="hairstyle">Hairstyle:</label>
                        <select id="hairstyle">
                            <option value="">Random (influenced by clothing style)</option>
                            <optgroup label="Unisex Styles">
                                <option value="AFRO">Afro</option>
                                <option value="MULLET">Mullet</option>
                                <option value="SHAVEN_HEADED">Shaved</option>
                            </optgroup>
                            <optgroup label="Men's Styles">
                                <option value="BALD">Bald</option>
                                <option value="MAN_BUN">Man Bun</option>
                                <option value="RECEDING">Receding</option>
                                <option value="SHORT_HAIR">Short</option>
                                <option value="SHOULDER_LENGTH_MENS_HAIR">Shoulder Length</option>
                            </optgroup>
                            <optgroup label="Women's Styles">
                                <option value="SHORT_BOB">Bob (Short)</option>
                                <option value="SHOULDER_BOB">Bob (Shoulder)</option>
                                <option value="BUN">Bun</option>
                                <option value="PIGTAILS">Pigtails</option>
                                <option value="PIXIE_CUT">Pixie</option>
                                <option value="PONYTAIL">Ponytail</option>
                                <option value="LONG_PONYTAIL">Ponytail (Long)</option>
                                <option value="SHOULDER_STRAIGHT">Straight (Shoulder)</option>
                                <option value="LONG_HAIR">Straight (Long)</option>
                                <option value="WAVY_SHOULDER_LENGTH">Wavy (Shoulder)</option>
                                <option value="WAVY_LONG">Wavy (Long)</option>
                            </optgroup>
                        </select>
                    </div>

                    <div id="custom-race-fields" style="display:none">
                        <div class="form-group">
                            <label for="custom-race">Custom Race:</label>
                            <input type="text" id="custom-race" placeholder="e.g. elven">
                            <div class="field-info">Should fit into "he's a/an [race] man" or "she's a/an [race] woman.</div>
                            <div class="field-info">If using a custom race, you must define eye, hair, and skin colours below.</div>
                        </div>
                    </div>
                        
                    <div class="form-group">
                        <label for="eye-colour">Eye Colour:</label>
                        <input type="text" id="eye-colour" placeholder="Leave blank for random or enter a custom colour" list="eye-colour-list">
                        <datalist id="eye-colour-list">
                            <option value="blue">
                            <option value="green">
                        </datalist>
                    </div>

                    <div class="form-group">
                        <label for="hair-colour">Hair Colour:</label>
                        <input type="text" id="hair-colour" placeholder="Leave blank for random or enter a custom colour" list="hair-colour-list">
                        <datalist id="hair-colour-list">
                            <option value="blue">
                            <option value="green">
                        </datalist>
                    </div>

                    <div class="form-group">
                        <label for="skin-colour">Skin Colour:</label>
                        <input type="text" id="skin-colour" placeholder="Leave blank for random or enter a custom colour" list="skin-colour-list">
                        <datalist id="skin-colour-list">
                            <option value="blue">
                            <option value="green">
                        </datalist>
                    </div>

                    <div class="row-divider"></div>


                    <div class="form-group">
                        <label for="character-personality">Personality:</label>
                        <select id="character-personality">
                            <option value="AVERAGE">Average</option>
                            <option value="CARING">Caring</option>
                            <option value="JERK">Jerk</option>
                            <option value="ROMANTIC">Romantic</option>
                            <option value="SELFISH">Selfish</option>
                        </select>
                    </div>


                    <div class="form-group">
                        <label for="career">Career:</label>
                        <select id="career">
                            <option value="">Random</option>
                            <option value="ACCOUNTANT">Accountant</option>
                            <option value="BARSTAFF">Barstaff</option>
                            <option value="BUSINESS">Business</option>
                            <option value="CIVIL_SERVANT">Civil Servant</option>
                            <option value="LIBRARY">Library</option>
                            <option value="SUPERMARKET_STAFF">Supermarket Staff</option>
                            <option value="UNEMPLOYED">Unemployed</option>
                            <option value="WAREHOUSE">Warehouse</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="friend-effect">Friend Effect:</label>
                        <select id="friend-effect">
                            <option value="">Random (influenced by traits and personality)</option>
                            <option value="CALMING_FRIEND">Calming</option>
                            <option class="female-effect" value="CRAZY_DRUNK_FRIEND">Crazy Drunk</option>
                            <option value="DANCE_NUT">Dance Nut</option>
                            <option value="EXPLOITATIVE_FRIEND">Exploitive</option>
                            <option value="FASHION_GURU">Fashion Guru</option>
                            <option value="GENEROUS_FRIEND">Generous</option>
                            <option class="female-effect" value="GRACEFUL_FRIEND">Graceful</option>
                            <option class="female-effect" value="IMPULSIVE_FRIEND">Impulsive</option>
                            <option value="MISANTHROPIC_FRIEND">Misanthropic</option>
                            <option value="MOOCHER">Moocher</option>
                            <option class="female-effect" value="NAIVE_FRIEND">Naive</option>
                            <option value="NEEDY_FRIEND">Needy</option>
                            <option value="PARTY_FRIEND">Party</option>
                            <option class="female-effect" value="SCAREDY_CAT">Scaredy Cat</option>
                            <option class="female-effect" value="VULNERABLE_FRIEND">Vulnerable</option>
                            <option value="WITTY_FRIEND">Witty</option>
                            <option class="female-effect" value="WORLDLY_FRIEND">Worldly</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="partner-effect">Partner Effect:</label>
                        <select id="partner-effect">
                            <option value="">Random (influenced by personality)</option>
                            <option value="AMBITIOUS_PARTNER">Ambitious</option>
                            <option value="ANGRY_PARTNER">Angry</option>
                            <option value="CARING_PARTNER">Caring</option>
                            <option class="male-effect" value="CHAUVINISTIC_PARTNER">Chauvinistic</option>
                            <option value="COLD_PARTNER">Cold</option>
                            <option value="EXPLOITATIVE_PARTNER">Exploitive</option>
                            <option value="FASCINATING_PARTNER">Fascinating</option>
                            <option value="FEEBLE_PARTNER">Feeble</option>
                            <option value="PEDANTIC_PARTNER">Pedantic</option>
                            <option value="PLEASANT_PARTNER">Pleasant</option>
                        </select>
                    </div>                               
                    
                    <div class="form-group">
                        <label for="boss-partner-effect">Boss Partner Effect:</label>
                        <select id="boss-partner-effect">
                            <option value="">Random (influenced by personality)</option>
                            <option value="BOSS_PARTNER_GENEROUS">Generous</option>
                            <option value="BOSS_PARTNER_SLAVEDRIVER">Slave Driver</option>
                            <option value="BOSS_PARTNER_SUPPORTIVE">Supportive</option>
                            <option value="BOSS_PARTNER_UNPROFESSIONAL">Unprofessional</option>
                        </select>
                        <div class="field-info">Only used if the NPC is the boss in a career track (see traits)</div>
                    </div>

                    <div class="row-divider female-only" style="display:none"></div> 
                    
                    <div class="form-group female-only" style="display:none">
                        <label for="breast-size">Breast Size:</label>
                        <select id="breast-size">
                            <option value="">Random</option>
                            <option value="SMALL">Small</option>
                            <option value="MEDIUM_SMALL">Medium Small</option>
                            <option value="MEDIUM_LARGE">Medium Large</option>
                            <option value="LARGE">Large</option>
                        </select>
                    </div>
                    
                    <div class="form-group female-only" style="display:none">
                        <label for="female-virgin">Virgin:</label>
                        <select id="female-virgin">
                            <option value="">Random (based on character type)</option>
                            <option value="TRUE">True</option>
                            <option value="FALSE">False</option>
                        </select>
                    </div>
                    
                    <div class="form-group female-only" style="display:none">
                        <label for="female-lesbian-virgin">Lesbian Virgin:</label>
                        <select id="female-lesbian-virgin">
                            <option value="">Random (influenced by character type)</option>
                            <option value="TRUE">True</option>
                            <option value="FALSE">False</option>
                        </select>
                    </div>
                    <div class="form-group female-only" style="display:none">
                        <label for="clothing-style">Clothing Style:</label>
                        <select id="clothing-style">
                            <option value="BUSINESSLIKE">Businesslike</option>
                            <option value="CHEERFUL">Cheerful</option>
                            <option value="CUTE">Cute</option>
                            <option value="ELEGANT">Elegant</option>
                            <option value="PROVOCATIVE">Provocative</option>
                            <option value="SCRUFFY">Scruffy</option>
                            <option value="WHOLESOME">Wholesome</option>
                            <option value="NONE">None (not recommended)</option>
                        </select>
                    </div>

                    
                    <div class="form-group female-only" style="display:none">
                        <label for="character-type-female">Character Type:</label>
                        <select id="character-type-female">
                            <option value="INNOCENT">Innocent</option>
                            <option value="PARTY_GIRL">Party Girl</option>
                            <option value="SOPHISTICATED">Sophisticated</option>
                        </select>
                        <div class="field-info">Affects how the NPC behaves</div>
                    </div>

                    <div class="row-divider"></div>
                        
                    <div class="form-group">
                        <label for="allow-additional-traits">Allow Additional Traits:</label>
                        <select id="allow-additional-traits">
                            <option value="TRUE">True</option>
                            <option value="FALSE">False</option>
                        </select>
                        <div class="field-info">If TRUE, the game may auto-add additional non-conflicting traits</div>
                    </div>
                    
                    <div class="traits-section">
                        <button type="button" id="traits-accordian" class="collapsible">Traits</button>
                        <div class="collapsible-content">
                            <div class="form-group" id="trait-filter-container">
                                <input type="text" id="trait-filter" placeholder="Filter traits...">
                            </div>
                            <div id="traits-container" class="traits-container">
                                <!-- Traits will be populated by JavaScript -->
                            </div>
                            <p>Selected Traits:</p>
                            <div id="selected-traits" class="selected-traits">
                                <!-- Selected traits will appear here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="traits-section">
                        <button type="button" id="blocked-traits-accordian" class="collapsible">Blocked Traits</button>
                        <div class="collapsible-content">
                            <div class="form-group" id="blocked-trait-filter-container">
                                <input type="text" id="blocked-trait-filter" placeholder="Filter blocked traits...">
                            </div>
                            <div id="blocked-traits-container" class="traits-container">
                                <!-- Traits will be populated by JavaScript -->
                            </div>
                            <p>Selected Blocked Traits:</p>
                            <div id="selected-blocked-traits" class="selected-traits">
                                <!-- Selected blocked traits will appear here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="buttons">
                        <button type="button" id="reset-button" class="secondary">Reset</button>
                        <button type="button" id="generate-button" class="primary">Generate YAML</button>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="tab-output">
                <textarea id="yaml-output" readonly></textarea>
                <button type="button" id="back-button" class="secondary">Back to Editor</button>
                <button type="button" id="copy-button" class="copy-button">Copy to Clipboard</button>
                <button type="button" id="download-button" class="download-button">Download YML File</button>
            </div>

            <!--<h2>JSON Data Preview</h2>
            <pre id="customRaceData">No data loaded yet.</pre>-->
        </div>
    </div>

    <script>
        // Trait data with descriptions and opposites
        const maleTraits = {
            // Physical traits
            "THICK_COCK": {
                version: "0.8.9",
                description: "The main \"big dick\" trait, frequently referenced in sex scenes and liked by pcs who love well endowed men.",
                opposites: ["SMALL_COCK"]
            },
            "SMALL_COCK": {
                version: "0.8.9",
                description: "This trait means he has a small dick that less-pleasant PCs can mock him for and those who prefer larger men might be disappointed by.",
                opposites: ["THICK_COCK"]
            },
            "BIG_COCK_HEAD": {
                version: "0.8.9",
                description: "Another trait for well-endowed men.",
                opposites: []
            },
            "BIG_BALLS": {
                version: "0.8.9",
                description: "Increases fertility and is referenced in sex scenes.",
                opposites: []
            },
            
            // Sexual preference traits
            "HATES_CONDOMS": {
                version: "0.8.9",
                description: "The NPC will usually refuse to wear a condom and will be annoyed at players who request them.\n\nCan appear on almost any npc, but more common on jerk, selfish, impregnator and less likely for caring men and those who don't want kids.",
                opposites: ["CONSCIENTIOUS"]
            },
            "CONSCIENTIOUS": {
                version: "0.8.9",
                description: "Prefers to use condoms and is much more likely to put one on without the pc asking. Will also respect her more for asking. More likely for men with nicer personalities or who don't want kids.",
                opposites: ["HATES_CONDOMS", "IMPREGNATOR"]
            },
            "VIGOROUS_LOVER": {
                version: "0.8.9",
                description: "The man is much more enthusiastic during sex and can use the 'rough' pace even if he's a nice guy who likes the pc, although his favourite pace is passionate.\n\nGenerally a good match for pcs with the passionate lover trait. At the moment this is equally likely for all npcs, although that might change in the future.",
                opposites: []
            },
            "MAGIC_FINGERS": {
                version: "0.8.9",
                description: "NPC equivalent of the PC's Clever Hands trait. Has somewhat limited effects - it's mostly only relevant when he's touching your pussy without clothing in the way.",
                opposites: ["INEPT_LOVER"]
            },
            "TALENTED_TONGUE": {
                version: "0.8.9",
                description: "Makes the NPC great at performing cunnilingus.",
                opposites: ["INEPT_LOVER"]
            },
            "INEPT_LOVER": {
                version: "0.8.9",
                description: "Makes the NPC bad in bed.",
                opposites: ["MAGIC_FINGERS", "TALENTED_TONGUE", "LIKES_GOING_DOWN", "LONG_LASTING"]
            },
            "QUICKSHOT": {
                version: "0.8.9",
                description: "Makes the NPC finish quicker when having sex.",
                opposites: ["LONG_LASTING"]
            },
            "LONG_LASTING": {
                version: "0.8.9",
                description: "Makes the NPC usually take longer when having sex.",
                opposites: ["QUICKSHOT", "INEPT_LOVER"]
            },
            
            // Appearance traits
            "HANDSOME": {
                version: "0.8.9",
                description: "Significantly increases the NPC's attractiveness.",
                opposites: ["UGLY"]
            },
            "UGLY": {
                version: "0.8.9",
                description: "Significantly reduces the NPC's attractiveness. This describes his face - it's possible for an ugly man to have a sexy body.",
                opposites: ["HANDSOME"]
            },
            
            // Preference traits
            "LIKES_CUTE": {
                version: "0.8.9",
                description: "He prefers cute characters, getting an attraction bonus based on your cuteness, and a penalty if you look naughty. Also finds it cute when shy girls have trouble holding up a conversation.",
                opposites: ["LIKES_SEXY"]
            },
            "LIKES_SEXY": {
                version: "0.8.9",
                description: "Prefers naughty characters, and finds cute ones annoying.",
                opposites: ["LIKES_CUTE", "TRADITIONAL"]
            },
            "LIKES_ELEGANT": {
                version: "0.8.9",
                description: "Prefers elegant characters, getting an attraction bonus based on elegance and penalty if you look casual.",
                opposites: ["LIKES_CASUAL"]
            },
            "LIKES_CASUAL": {
                version: "0.8.9",
                description: "More attracted to casual girls, less so to elegant ones.",
                opposites: ["LIKES_ELEGANT"]
            },
            
            // Personality traits
            "DULL": {
                version: "0.8.9",
                description: "He's boring to spend time with and you won't enjoy talking to him. Unless he's rocking your socks in bed, your character will usually dislike a dull npc and this means it'll be especially hard to become non-sexual friends with one.\n\nNormal NPCs will never be both dull and fashionable, but you can create custom ones with both traits.",
                opposites: ["INTERESTING", "OFFICE_HUNK"]
            },
            "INTERESTING": {
                version: "0.8.9",
                description: "Your character will like spending time with him.",
                opposites: ["DULL"]
            },
            "SLEAZY": {
                version: "0.8.9",
                description: "Also normally never shows up on romantic men, although this is ok for a custom NPC. Sleazy NPCs are a lot more sexual in talk and habits.",
                opposites: ["CHARMING", "TRADITIONAL"]
            },
            "CRUDE": {
                version: "0.8.9",
                description: "Like Sleazy, this never shows up on romantic NPCs unless you set it for a custom one. Crude mostly affects NPC's talk - they swear much more and annoy refined girls. However, crude men also don't hide how they feel. If they dislike you or are jerks, then they won't be able to fake being nice when they're trying to get you into bed.",
                opposites: ["CHARMING"]
            },
            "CHARMING": {
                version: "0.8.9",
                description: "Charming men can pretend to be romantic even when they aren't in love, and romantic girls will tend to like them a lot.",
                opposites: ["TACITURN", "CRUDE", "SLEAZY", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "PROSTITUTION_CLIENT", "SLEAZY_LANDLORD"]
            },
            "BOASTFUL": {
                version: "0.8.9",
                description: "Likes to boast a lot about himself, which can make him annoying unless he's also interesting. Because he's so self-absorbed, he won't mind when a shy girl can't carry her end of the conversation.",
                opposites: ["TACITURN"]
            },
            "TACITURN": {
                version: "0.8.9",
                description: "This trait never appears randomly in the game but the npc Horse has it. It's used to show he's the silent type, and disables several talking options.",
                opposites: ["BOASTFUL", "CHARMING"]
            },
            
            // Breast preference traits
            "LIKES_BIG_TITS": {
                version: "0.8.9",
                description: "More attracted to girls with large or medium-large breasts and less to girls with smaller ones. \n\nNPCs with a breast liking trait will sometimes get special content if they like/dislike the pc's breasts. NPCs without any of these three traits get a small bonus to attraction towards every breast size and will never especially like or dislike the player's bosom.",
                opposites: ["LIKES_MED_TITS", "LIKES_SMALL_TITS"]
            },
            "LIKES_MED_TITS": {
                version: "0.8.9",
                description: "More attracted to girls with medium-large or medium-small breasts and less to girls with large or small ones. \n\nNPCs with a breast liking trait will sometimes get special content if they like/dislike the pc's breasts. NPCs without any of these three traits get a small bonus to attraction towards every breast size and will never especially like or dislike the player's bosom.",
                opposites: ["LIKES_BIG_TITS", "LIKES_SMALL_TITS"]
            },
            "LIKES_SMALL_TITS": {
                version: "0.8.9",
                description: "More attracted to girls with small breasts and less to girls with larger ones. \n\nNPCs with a breast liking trait will sometimes get special content if they like/dislike the pc's breasts. NPCs without any of these three traits get a small bonus to attraction towards every breast size and will never especially like or dislike the player's bosom.",
                opposites: ["LIKES_BIG_TITS", "LIKES_MED_TITS"]
            },
            
            // Emotional traits
            "COLD_HEARTED": {
                version: "0.8.9",
                description: "Normally restricted to SELFISH NPCs but can be added to other custom ones. Prevents the character from ever gaining love points in any way. Love will always be fixed at 0 for this character.",
                opposites: []
            },
            "MISANTHROPE": {
                version: "0.8.9",
                description: "Normally restricted to JERK NPCs but can be added to other custom ones. Caps liking points at a fairly low value. It is impossible for a misanthrope to ever think better of you than as an ok person.",
                opposites: []
            },
            
            // Sexual traits
            "TASTY_SPERM": {
                version: "0.8.9",
                description: "Makes his cum taste pleasant.",
                opposites: ["NASTY_SPERM"]
            },
            "NASTY_SPERM": {
                version: "0.8.9",
                description: "Makes it very unpleasant if he finishes in your mouth. Following a player request early in development, this trait is rare among NPCs who don't have one of the 'bad' personality types.",
                opposites: ["TASTY_SPERM"]
            },
            "IMPREGNATOR": {
                version: "0.8.9",
                description: "An 'evil' trait that means he tries to get girls pregnant by underhand means. His behaviour after depends a bit on other traits. For example, if he also doesn't want kids then he'll try to knock girls up and then run out on them. \n\nThese NPCs will also try to sabotage your contraception. Normally only appears on jerks",
                opposites: ["LIKES_ANAL", "LIKES_ORAL", "CONSCIENTIOUS"]
            },
            
            // Relationship traits
            "TRADITIONAL": {
                version: "0.8.9",
                description: "Will normally only appear on Jerks as it's an explicitly chauvinistic trait, but can be manually assigned to others. These men will ask the PC to commit to being a housewife when they get married, and they're always ok with her staying a virgin until marriage.",
                opposites: ["SLEAZY", "LIKES_SEXY", "LIKES_TO_SHARE", "SLEAZY_OFFICE_WORKER", "PROSTITUTION_CLIENT", "SLEAZY_LANDLORD"]
            },
            "CHEATER": {
                version: "0.8.9",
                description: "This trait makes it much more likely for him to cheat on you in a relationship and he might do so even if you haven't done anything to make him feel you're a bad wife.\n\nAs of 0.4.23 the cheating content only appears when you're living together, so you'll need to get married first.\n\nDoesn't appear by default on Caring or Romantic NPCs.",
                opposites: []
            },
            "WANTS_KIDS": {
                version: "0.8.9",
                description: "The NPC wants to have children and will probably be a good dad. he'll react positively to the pc getting pregnant with his kid. Most common for romantic NPCs.",
                opposites: ["DOESNT_WANT_KIDS"]
            },
            "DOESNT_WANT_KIDS": {
                version: "0.8.9",
                description: "The NPC doesn't want children and will not be happy if the player gets pregnant with his child. Or with someone else's.",
                opposites: ["WANTS_KIDS"]
            },
            
            // Sex preference traits
            "LIKES_ORAL": {
                version: "0.8.9",
                description: "Enjoys oral sex more than the average npc and is more likely to initiate it.",
                opposites: ["IMPREGNATOR", "LIKES_ANAL", "PREFERS_SEX"]
            },
            "PREFERS_SEX": {
                version: "0.8.9",
                description: "Is not so keen on oral sex and similar activities as an alternative to full sex, although he doesn't outright hate it and you can still bring him off this way.\n\nThis mainly affects the \"oral\" scene which covers titjobs and masturbation as well. He's ok with this sort of thing as part of foreplay (i.e. in normal makeout scenes).\n\nThese npcs are much more likely to stop oral partway and return to normal makeouts.",
                opposites: ["LIKES_ORAL", "LIKES_ANAL"]
            },
            "LIKES_ANAL": {
                version: "0.8.9",
                description: "Enjoys anal sex more and is more likely to initiate it.\n\nThis trait will be removed from custom NPCs when they are loaded if anal sex is disabled in the game options.",
                opposites: ["IMPREGNATOR", "PREFERS_SEX", "LIKES_ORAL"]
            },
            "LIKES_GOING_DOWN": {
                version: "0.8.9",
                description: "The NPC enjoys giving cunnilingus more and will sometimes initiate it without the PC asking.",
                opposites: ["INEPT_LOVER"]
            },
            
            // Hobby traits
            "GOOD_DANCER": {
                version: "0.8.9",
                description: "He is better at dancing and can appear at the dance competition. All dance class NPCs have this trait but it's rare among other ones.",
                opposites: ["BAD_DANCER"]
            },
            "BAD_DANCER": {
                version: "0.8.9",
                description: "He hates dancing and is terrible at it.",
                opposites: ["GOOD_DANCER", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT"]
            },
            "FASHIONABLE": {
                version: "0.8.9",
                description: "Dresses in more fashionable clothes and enjoys it more if you try to befriend him by taking him clothes shopping.\n\nNormal NPCs will never have both this trait and dull, but custom ones can.",
                opposites: []
            },
            
            // Relationship dynamic traits
            "DOORMAT": {
                version: "0.8.9",
                description: "NPCs with this trait don't like the PC cheating on them but they'll just complain about it without actually breaking up with her.",
                opposites: ["LIKES_TO_SHARE"]
            },
            "LIKES_TO_SHARE": {
                version: "0.8.9",
                description: "These NPCs find it a turn-on if their partner sleeps with other men. Note that most NPCs have neither this trait nor doormat. An NPC with neither will be upset if the PC cheats on them and may break up with her.",
                opposites: ["DOORMAT", "TRADITIONAL"]
            },
            "LIKES_COOKING": {
                version: "0.8.9",
                description: "Likes to cook and is good at it. These NPCs can appear as students in the cooking class as long as they aren't set to have no random appearances.",
                opposites: []
            },
            
            // Special NPC traits
            "REPAIRMAN": {
                version: "0.8.9",
                description: "Allows the NPC to show up as the repairman if one of your appliances breaks. There can be more than one repairman and if so then one will be picked randomly when needed.\n\nIf you don't create a custom repairman then the game will add exactly one. Non-custom NPC repairmen always have the Magic Fingers trait (because they're \"good with their hands\") but are otherwise the same as other NPCs and can show up in the nightclub and similar places before appearing to make repairs.\n\nOther than letting him show up in the relevant scene, the repairman trait has no effects whatsoever.",
                opposites: ["PIMP_LANDLORD", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "LOWLIFE": {
                version: "0.8.9",
                description: "These characters can appear in a certain event. Unlike repairmen, they will never appear otherwise - you'll never see them in the club for example.\n\nThe appropriate scene assumes that lowlives are Jerks who lack the Charming trait. Creating a custom lowlife who doesn't fit this definition is not recommended as it could lead to odd behaviour - switching between asshole and nice-guy attitudes depending on whether the scene in question includes support for other personality types. However, such NPCs are valid and will load, even if they act strangely in-game.\n\nNewlife will ensure there are at least 3 lowlives, even if you don't create any. Default lowlives are always jerks of one of the 2 younger age categories without the Charming or Fashionable traits. Both custom and default lowlives cannot be befriended and will not show up in scenes unless specifically set to appear.",
                opposites: ["REPAIRMAN", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "SALES_BOSS": {
                version: "0.8.9",
                description: "This custom NPC will replace the usual boss for the sales career. There can only be one sales boss in a game. The sales boss will not be randomly picked for scenes like the nightclub. It is possible for a boss to become dateable through events though.\n\nIf you don't create a boss, one will be generated by the game.",
                opposites: ["PIMP_LANDLORD", "REPAIRMAN", "LOWLIFE", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "OFFICE_BOSS": {
                version: "0.8.9",
                description: "Similar to the sales boss, but for the office career. The default sales boss is always selfish or a jerk, so picking a different personality may result in odd behaviour during his special scenes.",
                opposites: ["PIMP_LANDLORD", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "OFFICE_HUNK": {
                version: "0.8.9",
                description: "A handsome colleague for the office career.\n\nWill always be given a CARING personality and the HANDSOME trait, overriding any values set here.\n\nWill also never be dull although he is not guaranteed to be INTERESTING.",
                opposites: ["PIMP_LANDLORD", "DULL","REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "SLEAZY_OFFICE_WORKER": {
                version: "0.8.9",
                description: "A jerk NPC that can appear in the office party. There are always 2 of these, normally the same age as each other but this is not enforced if they are both custom NPCs.\n\nThe game will ensure that these characters are sleazy jerks, overriding any conflicting values.",
                opposites: ["PIMP_LANDLORD", "CHARMING", "TRADITIONAL", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "GYM_JERK": {
                version: "0.8.9",
                description: "This custom NPC can appear normally in nightclubs etc and is also the jerk that can lead the player-character into changing-room hanky-panky.\n\nThere are a lot of special requirements for this NPC, and the game will override the relevant values if they aren't set. Specifically, he must have the Jerk personality, the Sleazy, Cold-hearted and Misanthrope traits and either Toned, Thickset or Muscular body type.\n\nThere can only be one gym jerk in a game, so if you create several then only the highest priority one will be used.",
                opposites: ["PIMP_LANDLORD", "CHARMING", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "BOYFRIENDS_JERK_FRIEND": {
                version: "0.8.9",
                description: "This NPC will be used for the jerk-friend storyline. They won't be present at the start but will be created if the NPC is needed.\n\nThe jerk-friend NPC has a lot of fixed traits that will override any conflicting ones set here.",
                opposites: ["PIMP_LANDLORD", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "PROSTITUTION_CLIENT": {
                version: "0.8.9",
                description: "This one may try to pay you for sex. He won't appear in the club or similar random encounters. This NPC is always SLEAZY (the game will add it if you don't).\n\nIf his age is left blank then he'll tend to be an older man, but if it's set then the game will use whatever you put in there.",
                opposites: ["PIMP_LANDLORD", "CHARMING", "TRADITIONAL", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "DANCE_JUDGE": {
                version: "0.8.9",
                description: "The judge for the dance competition. This NPC can appear randomly but will always be chosen to judge dance contests.\n\nAlways has the GOOD_DANCER trait (this will be added when the NPC is loaded if you don't set it here). Default judges will be older men, but you can override this by setting a younger age.",
                opposites: ["PIMP_LANDLORD", "BAD_DANCER", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "DANCE_TEACHER": {
                version: "0.8.9",
                description: "Always has GOOD_DANCER, FASHIONABLE and the TONED body type: these will be set automatically and will override any conflicting values that you set. The teacher is hidden until you take a dance class and meet him for the first time.",
                opposites: ["PIMP_LANDLORD", "BAD_DANCER", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "DANCE_STUDENT": {
                version: "0.8.9",
                description: "Always have the GOOD_DANCER trait. Will be hidden until you take a dance class. You can create multiple students and all will be loaded every time with no limits - very large numbers might cause issues in the game so don't go nuts. The minimum is 3. The game will create students up to that number if there are fewer custom ones.\n\nAll dance students will appear and be met in the first dance class. Thereafter the normal dance class event includes two, chosen at random. Like the dance teacher, students can appear in random events like the club, but only after meeting them in the first class.",
                opposites: ["PIMP_LANDLORD", "BAD_DANCER", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "COOKING_TEACHER": {
                version: "0.8.9",
                description: "This NPC can teach cooking classes. Should always have the LIKES_COOKING trait - the game will add this if it isn't set.",
                opposites: ["PIMP_LANDLORD", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "PORN_ACTOR": {
                version: "0.8.9",
                description: "This NPC can appear as a co-star if the PC ends up performing in a porn video. There's no other restriction on these NPCs but the game will prevent them from appearing in scenes other than their own special ones.",
                opposites: ["PIMP_LANDLORD", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "EVIL_HYPNOTIST": {
                version: "0.8.9",
                description: "Must have Jerk personality. Will be set to no-random-appearances until the PC has been hypnotised by him at least once.",
                opposites: ["PIMP_LANDLORD", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "GOOD_HYPNOTIST": {
                version: "0.8.9",
                description: "Should have Average, Romantic or Caring personality. Will be set to no-random-appearances until the PC has been hypnotised by him at least once.",
                opposites: ["PIMP_LANDLORD", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD", "PLEASANT_HOME_LANDLORD", "CHEAP_HOME_LANDLORD"]
            },
            "HYPNOTIST": {
                version: "0.8.9",
                description: "Allows the NPC to appear in hypnosis-related scenes that aren't restricted to a special NPC. Only rarely used in main content. Does not mark the NPC as a special NPC.",
                opposites: []
            },
            "SLEAZY_LANDLORD": {
                version: "0.8.9",
                description: "This is the PC's sleazy landlord, the game will ensure he is a SLEAZY jerk, overriding conflicting values if you set them.",
                opposites: ["CHARMING", "TRADITIONAL", "REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "PIMP_LANDLORD", "SILVER_SPOON_LANDLORD"]
            },
            "PIMP_LANDLORD": {
                version: "0.8.12",
                description: "Placeholder description for PIMP landlord while I wait for access to 0.8.12 npc template (note: validation for conflicting traits are also placeholder but should be mostly correct)",
                opposites: ["REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "SILVER_SPOON_LANDLORD"]
            },
            "SILVER_SPOON_LANDLORD": {
                version: "0.8.9",
                description: "This is the 'silver-spoon' landlord who comes from a wealthy family. This NPC will always have the ROMANTIC personality (the game will override any alternative choices).\n\nThis NPC will not normally be generated older than TWENTIES, but if you set a custom one to older then it will be limited to THIRTIES instead.",
                opposites: ["REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST", "SLEAZY_LANDLORD", "PIMP_LANDLORD"]
            },
            "PLEASANT_HOME_LANDLORD": {
                version: "0.8.9",
                description: "If set, it will assign him to be the landlord for the pleasant neighbourhood.\n\nA landlord with just one neighbourhood trait will be guaranteed to become landlord for that home, with the other landlord taking the second.\n\nA landlord with both pleasant and cheap neighbourhood traits will be landlord for both (and the other landlord will not appear in the game).\n\nIf neither landlord has any neighbourhood traits then they'll get one each, chosen randomly.",
                opposites: ["REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST"]
            },
            "CHEAP_HOME_LANDLORD": {
                version: "0.8.9",
                description: "Assigns a landlord character to the CHEAP neighbourhood where the PC has her first home at the start of the game.",
                opposites: ["REPAIRMAN", "LOWLIFE", "SALES_BOSS", "OFFICE_BOSS", "OFFICE_HUNK", "SLEAZY_OFFICE_WORKER", "GYM_JERK", "BOYFRIENDS_JERK_FRIEND", "PROSTITUTION_CLIENT", "DANCE_JUDGE", "DANCE_TEACHER", "DANCE_STUDENT", "COOKING_TEACHER", "PORN_ACTOR", "EVIL_HYPNOTIST", "GOOD_HYPNOTIST"]
            },
            
            // Hidden traits
            "NO_BEFRIEND": {
                version: "0.8.9",
                description: "A hidden trait that's usually used to limit special NPCs. Most hidden traits would cause problems on custom NPCs but this one would be ok so I've allowed it. NPCs with this trait can never be befriended. They can still become your boyfriend though.",
                opposites: []
            },
            "INFERTILE": {
                version: "0.8.9",
                description: "A hidden trait that is only used for custom NPCs. Men with this trait will never get you pregnant. It doesn't change in-game text. There'll still be \"pregnancy risk\" dialogue and so on: presumably neither you nor him know about his infertility.",
                opposites: []
            },
            "UNLOVABLE": {
                version: "0.8.9",
                description: "A hidden trait that is only used for custom NPCs. The PC will never fall in love with this NPC.",
                opposites: []
            },
            "ODDLY_UNATTRACTIVE": {
                version: "0.8.9",
                description: "A hidden trait that is only used for custom NPCs. Caps PC's starting attraction to a low level regardless of other factors.",
                opposites: []
            },
            "CUNNING": {
                version: "0.8.9",
                description: "The PC's partner will never discover cheating with this NPC on his own.",
                opposites: []
            },
            "TESTING_TRAIT": {
                version: "0.0.0",
                description: "A trait used for testing of custom scenes that has no effects in the main game. It will show up in the character browser at any level of knowledge.",
                opposites: []
            }
        };

        const femaleTraits = {
            // Appearance traits
            "BEAUTIFUL": {
                version: "0.8.9",
                description: "Makes her more attractive",
                opposites: ["PLAIN"]
            },
            "PLAIN": {
                version: "0.8.9",
                description: "Makes her less attractive",
                opposites: ["BEAUTIFUL"]
            },
            
            // Sexual traits
            "HATES_CONDOMS": {
                version: "0.8.9",
                description: "The NPC prefers unprotected sex when she's with a man",
                opposites: []
            },
            "VIGOROUS_LOVER": {
                version: "0.8.9",
                description: "The NPC is a very passionate lover",
                opposites: []
            },
            "MAGIC_FINGERS": {
                version: "0.8.9",
                description: "Very good at using her hands during intimate moments",
                opposites: ["INEPT_LOVER"]
            },
            "TALENTED_TONGUE": {
                version: "0.8.9",
                description: "Makes the NPC great at performing oral sex",
                opposites: ["INEPT_LOVER"]
            },
            "INEPT_LOVER": {
                version: "0.8.9",
                description: "Makes the NPC bad in bed",
                opposites: ["MAGIC_FINGERS", "TALENTED_TONGUE"]
            },
            
            // Preference traits
            "LIKES_CUTE": {
                version: "0.8.9",
                description: "More attracted to cute characters",
                opposites: ["LIKES_SEXY"]
            },
            "LIKES_SEXY": {
                version: "0.8.9",
                description: "Prefers naughty characters, finds cute ones annoying",
                opposites: ["LIKES_CUTE"]
            },
            "LIKES_ELEGANT": {
                version: "0.8.9",
                description: "Prefers elegant characters",
                opposites: ["LIKES_CASUAL"]
            },
            "LIKES_CASUAL": {
                version: "0.8.9",
                description: "More attracted to casual girls, less to elegant ones",
                opposites: ["LIKES_ELEGANT"]
            },
            
            // Personality traits
            "DULL": {
                version: "0.8.9",
                description: "She's boring to spend time with",
                opposites: ["INTERESTING"]
            },
            "INTERESTING": {
                version: "0.8.9",
                description: "Your character will like spending time with her",
                opposites: ["DULL"]
            },
            "BOASTFUL": {
                version: "0.8.9",
                description: "Likes to boast about herself",
                opposites: []
            },
            
            // Breast preference traits
            "LIKES_BIG_TITS": {
                version: "0.8.9",
                description: "More attracted to girls with large breasts",
                opposites: ["LIKES_MED_TITS", "LIKES_SMALL_TITS"]
            },
            "LIKES_MED_TITS": {
                version: "0.8.9",
                description: "Prefers medium-sized breasts",
                opposites: ["LIKES_BIG_TITS", "LIKES_SMALL_TITS"]
            },
            "LIKES_SMALL_TITS": {
                version: "0.8.9",
                description: "Prefers smaller breasts",
                opposites: ["LIKES_BIG_TITS", "LIKES_MED_TITS"]
            },
            
            // Emotional traits
            "COLD_HEARTED": {
                version: "0.8.9",
                description: "Prevents gaining love points",
                opposites: []
            },
            "MISANTHROPE": {
                version: "0.8.9",
                description: "Caps liking points at a low value",
                opposites: []
            },
            
            // Parenting traits
            "WANTS_KIDS": {
                version: "0.8.9",
                description: "Wants to have children",
                opposites: ["DOESNT_WANT_KIDS"]
            },
            "DOESNT_WANT_KIDS": {
                version: "0.8.9",
                description: "Doesn't want children",
                opposites: ["WANTS_KIDS"]
            },
            "MILKY": {
                version: "0.8.9",
                description: "The character will always lactate",
                opposites: []
            },
            
            // Sex preference traits
            "LIKES_ORAL": {
                version: "0.8.9",
                description: "Enjoys oral sex more than average",
                opposites: ["PREFERS_SEX"]
            },
            "PREFERS_SEX": {
                version: "0.8.9",
                description: "Not so keen on oral sex and similar activities",
                opposites: ["LIKES_ORAL", "LIKES_ANAL"]
            },
            "LIKES_ANAL": {
                version: "0.8.9",
                description: "Enjoys anal sex more",
                opposites: ["PREFERS_SEX", "LIKES_ORAL"]
            },
            "LIKES_GOING_DOWN": {
                version: "0.8.9",
                description: "The NPC enjoys giving oral sex",
                opposites: []
            },
            
            // Activity traits
            "GOOD_DANCER": {
                version: "0.8.9",
                description: "Better at dancing",
                opposites: ["BAD_DANCER"]
            },
            "BAD_DANCER": {
                version: "0.8.9",
                description: "Hates dancing and is terrible at it",
                opposites: ["GOOD_DANCER"]
            },
            
            // Relationship traits
            "DOORMAT": {
                version: "0.8.9",
                description: "Don't like cheating but won't break up over it",
                opposites: ["LIKES_TO_SHARE"]
            },
            "LIKES_TO_SHARE": {
                version: "0.8.9",
                description: "Finds it a turn-on if their partner sleeps with others",
                opposites: ["DOORMAT"]
            },
            "LIKES_COOKING": {
                version: "0.8.9",
                description: "Likes to cook and is good at it",
                opposites: []
            },
            "CHEATER": {
                version: "0.8.9",
                description: "More likely to cheat in relationships",
                opposites: []
            },
            "HYPNOTIST": {
                version: "0.8.9",
                description: "Can appear in hypnosis-related scenes",
                opposites: []
            },
            
            // Special NPC traits
            "INNOCENT_SALES_COLLEAGUE": {
                version: "0.8.9",
                description: "Special NPC: appears as your colleague at work",
                opposites: ["OFFICE_RIVAL", "FLIRTY_NIGHTCLUB_LESBIAN", "POSH_NIGHTCLUB_LESBIAN"]
            },
            "OFFICE_RIVAL": {
                version: "0.8.9",
                description: "Special NPC: PC's rival in the office career",
                opposites: ["INNOCENT_SALES_COLLEAGUE", "FLIRTY_NIGHTCLUB_LESBIAN", "POSH_NIGHTCLUB_LESBIAN"]
            },
            "FLIRTY_NIGHTCLUB_LESBIAN": {
                version: "0.8.9",
                description: "Special NPC: lesbian the PC can dance with at the club",
                opposites: ["INNOCENT_SALES_COLLEAGUE", "OFFICE_RIVAL", "POSH_NIGHTCLUB_LESBIAN"]
            },
            "POSH_NIGHTCLUB_LESBIAN": {
                version: "0.8.9",
                description: "Special NPC: lesbian the PC can dance with at the club",
                opposites: ["INNOCENT_SALES_COLLEAGUE", "OFFICE_RIVAL", "FLIRTY_NIGHTCLUB_LESBIAN"]
            },
            
            // Hidden traits
            "NO_BEFRIEND": {
                version: "0.8.9",
                description: "Hidden trait: NPCs can never be befriended",
                opposites: []
            },
            "UNLOVABLE": {
                version: "0.8.9",
                description: "Hidden trait: PC will never fall in love with this NPC",
                opposites: []
            },
            "ODDLY_UNATTRACTIVE": {
                version: "0.8.9",
                description: "Hidden trait: caps PC's starting attraction to a low level",
                opposites: []
            },
            "CUNNING": {
                version: "0.8.9",
                description: "PC's partner won't discover cheating with this NPC",
                opposites: []
            },
            "DONT_TAKE_PILL": {
                version: "0.8.9",
                description: "NPC will never go on the pill",
                opposites: []
            },
            "TESTING_TRAIT": {
                version: "0.0.0",
                description: "Used for testing of custom scenes",
                opposites: []
            }
        };

        // Race Data
        const defaultRaceData = {
            "raceDefs": [
                {
                    "race": "white",
                    "skinColours": [
                        "pale",
                        "rosy",
                        "tanned",
                        "olive"
                    ],
                    "hairColours": [
                        "black",
                        "platinum blonde",
                        "blonde",
                        "sandy",
                        "strawberry blonde",
                        "dark brown",
                        "chestnut",
                        "light brown",
                        "auburn",
                        "red"
                    ],
                    "eyeColours": [
                        "amber",
                        "pale blue",
                        "deep blue",
                        "light brown",
                        "dark brown",
                        "green",
                        "grey",
                        "hazel"
                    ],
                    "nameLists": {
                        "general": 80,
                        "irish": 10,
                        "scottish": 10
                    }
                },
                {
                    "race": "black",
                    "skinColours": [
                        "light brown",
                        "dark brown",
                        "ebony"
                    ],
                    "hairColours": [
                        "black",
                        "dark brown",
                        "light brown"
                    ],
                    "eyeColours": [
                        "light brown",
                        "dark brown"
                    ],
                    "nameLists": {
                        "general": 50,
                        "nigerian": 30,
                        "swahili": 20
                    }
                },
                {
                    "race": "east asian",
                    "skinColours": [
                        "golden-brown",
                        "porcelain"
                    ],
                    "hairColours": [
                        "black",
                        "dark brown"
                    ],
                    "eyeColours": [
                        "light brown",
                        "dark brown"
                    ],
                    "nameLists": {
                        "general": 40,
                        "chinese": 30,
                        "japanese": 30
                    }
                },
                {
                    "race": "south asian",
                    "skinColours": [
                        "light brown",
                        "dark brown"
                    ],
                    "hairColours": [
                        "black",
                        "dark brown"
                    ],
                    "eyeColours": [
                        "light brown",
                        "dark brown",
                        "green"
                    ],
                    "nameLists": {
                        "general": 20,
                        "arabic": 10,
                        "indian": 70
                    }
                },
                {
                    "race": "middle-eastern",
                    "skinColours": [
                        "light brown",
                        "dark brown",
                        "olive"
                    ],
                    "hairColours": [
                        "black",
                        "dark brown",
                        "light brown"
                    ],
                    "eyeColours": [
                        "light brown",
                        "dark brown",
                        "hazel",
                        "amber",
                        "grey"
                    ],
                    "nameLists": {
                        "general": 20,
                        "arabic": 55,
                        "turkish": 25
                    }
                }
            ],
            "nameLists": [
                {
                    "id": "general",
                    "maleNames": [
                        "Cliff",
                        "Oliver",
                        "Jack",
                        "Harry",
                        "Jacob",
                        "Charlie",
                        "Thomas",
                        "Oscar",
                        "William",
                        "James",
                        "George",
                        "Alfie",
                        "Joshua",
                        "Ethan",
                        "Archie",
                        "Leo",
                        "Henry",
                        "Joseph",
                        "Samuel",
                        "Riley",
                        "Daniel",
                        "Alexander",
                        "Max",
                        "Lucas",
                        "Mason",
                        "Logan",
                        "Isaac",
                        "Benjamin",
                        "Dylan",
                        "Jake",
                        "Edward",
                        "Freddie",
                        "Tyler",
                        "Sebastian",
                        "Adam",
                        "Theo",
                        "Jayden",
                        "Arthur",
                        "Toby",
                        "Luke",
                        "Lewis",
                        "Matthew",
                        "Harvey",
                        "David",
                        "Ryan",
                        "Tommy",
                        "Michael",
                        "Reuben",
                        "Nathan",
                        "Blake",
                        "Bobby",
                        "Charles",
                        "Frankie",
                        "Alex",
                        "Connor",
                        "Liam",
                        "Jamie",
                        "Stanley",
                        "Hugo",
                        "Leon",
                        "Louis",
                        "Theodore",
                        "Gabriel",
                        "Ollie",
                        "Aaron",
                        "Frederick",
                        "Evan",
                        "Elliott",
                        "Owen",
                        "Cameron",
                        "Rory",
                        "Seth",
                        "Robert",
                        "Albert",
                        "Joel",
                        "John",
                        "Finn",
                        "Taylor",
                        "Kyle",
                        "Patrick",
                        "Sam",
                        "Carter",
                        "Corey",
                        "Roman",
                        "Ben",
                        "Anthony",
                        "Andrew",
                        "Jason",
                        "Ralph",
                        "Will",
                        "Bill",
                        "Rob",
                        "Bob",
                        "Ed",
                        "Brad",
                        "Chris",
                        "Nick",
                        "Cubano",
                        "Eduardo",
                        "Lachlan",
                        "Noah",
                        "Cooper",
                        "Hayden",
                        "Nathaniel",
                        "Jett",
                        "Austin",
                        "Cohen",
                        "Fletcher",
                        "Zack",
                        "Spencer",
                        "Parker",
                        "Chase",
                        "Kai",
                        "Archer",
                        "Milo",
                        "Cole",
                        "Vincent",
                        "Brandon",
                        "Levi",
                        "Jonathan",
                        "Brody",
                        "Jonah",
                        "Xavier",
                        "Marcus",
                        "Beau",
                        "Layton",
                        "Kevin",
                        "Myles",
                        "Ted",
                        "Peter",
                        "Maximilian",
                        "Jensen",
                        "Alan",
                        "Marley",
                        "Oskar",
                        "Arlo",
                        "Kieran",
                        "Ewan",
                        "Lukas",
                        "Joe",
                        "Maximus",
                        "Leonardo",
                        "Rayyan",
                        "Declan",
                        "Zain",
                        "Jay",
                        "Adrian",
                        "Lincoln",
                        "Fraser",
                        "Danny",
                        "Oakley",
                        "Hunter",
                        "Barnaby",
                        "Kye",
                        "Rupert",
                        "Rhys",
                        "Idris",
                        "Jordan",
                        "Fabian",
                        "Ashley",
                        "Trent",
                        "Jesse",
                        "Jules",
                        "Carlos",
                        "Dafyyd"
                    ],
                    "femaleNames": [
                        "Amelia",
                        "Olivia",
                        "Emily",
                        "Poppy",
                        "Isabella",
                        "Jessica",
                        "Lily",
                        "Sophie",
                        "Grace",
                        "Mia",
                        "Evie",
                        "Ruby",
                        "Ella",
                        "Scarlett",
                        "Isabelle",
                        "Chloe",
                        "Sienna",
                        "Freya",
                        "Phoebe",
                        "Charlotte",
                        "Daisy",
                        "Alice",
                        "Florence",
                        "Eva",
                        "Sofia",
                        "Millie",
                        "Lucy",
                        "Evelyn",
                        "Elsie",
                        "Rosie",
                        "Imogen",
                        "Lola",
                        "Matilda",
                        "Elizabeth",
                        "Layla",
                        "Holly",
                        "Lilly",
                        "Molly",
                        "Erin",
                        "Ellie",
                        "Maisie",
                        "Maya",
                        "Abigail",
                        "Eliza",
                        "Georgia",
                        "Jasmine",
                        "Willow",
                        "Bella",
                        "Annabelle",
                        "Amber",
                        "Emilia",
                        "Emma",
                        "Summer",
                        "Hannah",
                        "Eleanor",
                        "Harriet",
                        "Rose",
                        "Amelie",
                        "Lexi",
                        "Megan",
                        "Gracie",
                        "Zara",
                        "Lacey",
                        "Martha",
                        "Anna",
                        "Violet",
                        "Maria",
                        "Brooke",
                        "Katie",
                        "Leah",
                        "Thea",
                        "Darcie",
                        "Hollie",
                        "Amy",
                        "Mollie",
                        "Heidi",
                        "Lottie",
                        "Bethany",
                        "Francesca",
                        "Faith",
                        "Harper",
                        "Nancy",
                        "Beatrice",
                        "Isabel",
                        "Darcy",
                        "Lydia",
                        "Sarah",
                        "Julia",
                        "Victoria",
                        "Zoe",
                        "Robyn",
                        "Penelope",
                        "Elsa",
                        "Paige",
                        "Mila",
                        "Alexandra",
                        "Iris",
                        "Skye",
                        "Tilly",
                        "Isobel",
                        "Eloise",
                        "Lyla",
                        "Nevaeh",
                        "Annie",
                        "Lara",
                        "Maddison",
                        "Annabel",
                        "Clara",
                        "Edith",
                        "Orla",
                        "Keira",
                        "Arabella",
                        "Alexis",
                        "Gabriella",
                        "Lena",
                        "Lauren",
                        "Felicity",
                        "Savannah",
                        "Eden",
                        "Rebecca",
                        "Caitlin",
                        "Esra",
                        "Libby",
                        "Lois",
                        "Nicole",
                        "Vanessa"
                    ]
                },
                {
                    "id": "scottish",
                    "maleNames": [
                        "Callum",
                        "Lachlan",
                        "Hamish",
                        "Lennox",
                        "Angus",
                        "Malcolm",
                        "Fergus",
                        "Duncan",
                        "Ross",
                        "Lyle",
                        "Fraser",
                        "Gordon",
                        "Brodie",
                        "Murray",
                        "Alasdair",
                        "Tavish",
                        "Graeme",
                        "Dougal",
                        "Stewart"
                    ],
                    "femaleNames": [
                        "Isla",
                        "Esme",
                        "Elsie",
                        "Maisie",
                        "Arabella",
                        "Flora",
                        "Bonnie",
                        "Blair",
                        "Fiona",
                        "Eilidh",
                        "Alba",
                        "Skye",
                        "Elspeth",
                        "Nessa",
                        "Paisley",
                        "Mackenzie",
                        "Iona",
                        "Mirren",
                        "Morag",
                        "Caitriona",
                        "Morven",
                        "Breagha",
                        "Mhairi",
                        "Rhona"
                    ]
                },
                {
                    "id": "irish",
                    "maleNames": [
                        "Finn",
                        "Ronan",
                        "Rory",
                        "Kieran",
                        "Liam",
                        "Flynn",
                        "Declan",
                        "Cormac",
                        "Quinn",
                        "Eamon",
                        "Seamus",
                        "Aidan",
                        "Niall",
                        "Ciaran",
                        "Blaine",
                        "Colm",
                        "Daragh",
                        "Eoin",
                        "Callum",
                        "Donal",
                        "Lorcan"
                    ],
                    "femaleNames": [
                        "Maeve",
                        "Nora",
                        "Sloane",
                        "Quinn",
                        "Rowan",
                        "Riley",
                        "Niamh",
                        "Neve",
                        "Orla",
                        "Bridget",
                        "Brianna",
                        "Siobhan",
                        "Keira",
                        "Fia",
                        "Teagan",
                        "Shea",
                        "Roisin",
                        "Ciara",
                        "Bree",
                        "Kara",
                        "Sorcha",
                        "Caitlin",
                        "Sinead",
                        "Tara",
                        "Deirdre",
                        "Aislinn",
                        "Fianna"
                    ]
                },
                {
                    "id": "arabic",
                    "maleNames": [
                        "Muhammad",
                        "Ali",
                        "Amir",
                        "Ibrahim",
                        "Malik",
                        "Nasir",
                        "Omar",
                        "Samir",
                        "Yusuf",
                        "Amin",
                        "Osman",
                        "Rahim",
                        "Musa",
                        "Mustafa",
                        "Hamza",
                        "Zayn",
                        "Malik",
                        "Zaid",
                        "Zahir",
                        "Jamal",
                        "Khalil",
                        "Tariq",
                        "Khalid",
                        "Yasir",
                        "Ahmed",
                        "Zaki",
                        "Hakeem",
                        "Hassan",
                        "Kamil",
                        "Kareem",
                        "Salah",
                        "Nadir",
                        "Qasim",
                        "Salman",
                        "Abdullah",
                        "Farouk",
                        "Ismail",
                        "Rafiq",
                        "Rashad",
                        "Faisal",
                        "Jamil",
                        "Latif",
                        "Nasim",
                        "Daoud"
                    ],
                    "femaleNames": [
                        "Maryam",
                        "Aisha",
                        "Zainab",
                        "Elif",
                        "Azra",
                        "Abrar",
                        "Lilah",
                        "Aaliyah",
                        "Alia",
                        "Aida",
                        "Zariah",
                        "Amina",
                        "Noor",
                        "Fatima",
                        "Yasmin",
                        "Aziza",
                        "Samira",
                        "Sadiya",
                        "Amani",
                        "Safiyya",
                        "Anisa",
                        "Khadija",
                        "Amirah",
                        "Yamina",
                        "Anaya"
                    ]
                },
                {
                    "id": "turkish",
                    "maleNames": [
                        "Ayin",
                        "Emir",
                        "Osman",
                        "Eren",
                        "Deniz",
                        "Emre",
                        "Aslan",
                        "Taylan",
                        "Kaan",
                        "Mehmet",
                        "Selim",
                        "Turgut",
                        "Noyan",
                        "Gunduz",
                        "Ilay",
                        "Seran",
                        "Yaz",
                        "Ilhan",
                        "Zeki",
                        "Beyram"
                    ],
                    "femaleNames": [
                        "Ayla",
                        "Ada",
                        "Mihrimah",
                        "Mavi",
                        "Miral",
                        "Xayah",
                        "Belkis",
                        "Aylin",
                        "Elif",
                        "Sila",
                        "Kayra",
                        "Nuray",
                        "Harika",
                        "Derya",
                        "Sema"
                    ]
                },
                {
                    "id": "nigerian",
                    "maleNames": [
                        "Chidera",
                        "Ayomi",
                        "Ayomide",
                        "Kamsi",
                        "Yemi",
                        "Ike",
                        "Obie",
                        "Obinna",
                        "Olufemi",
                        "Atiba",
                        "Babatunde",
                        "Ade",
                        "Ayodeji",
                        "Chidi",
                        "Adewale",
                        "Adebayo",
                        "Ajani",
                        "Iniko",
                        "Agu",
                        "Kehinde",
                        "Ajamu",
                        "Diji",
                        "Amazu"
                    ],
                    "femaleNames": [
                        "Oluchi",
                        "Dayo",
                        "Oba",
                        "Adeya",
                        "Nene",
                        "Praise",
                        "Ayomi",
                        "Ola",
                        "Amara",
                        "Nneka",
                        "Ajah",
                        "Sade"
                    ]
                },
                {
                    "id": "swahili",
                    "maleNames": [
                        "Khari",
                        "Nyjah",
                        "Kion",
                        "Amani",
                        "Kimani",
                        "Jelani",
                        "Neema",
                        "Jahari",
                        "Riziki",
                        "Koko",
                        "Onaje",
                        "Dakari",
                        "Kobie"
                    ],
                    "femaleNames": [
                        "Nala",
                        "Nia",
                        "Khari",
                        "Nyjah",
                        "Imani",
                        "Zuri",
                        "Ayanna",
                        "Nya",
                        "Nalia",
                        "Emani",
                        "Malaika"
                    ]
                },
                {
                    "id": "indian",
                    "maleNames": [
                        "Sahil",
                        "Arjun",
                        "Vihaan",
                        "Reyansh",
                        "Ravi",
                        "Sajan",
                        "Ishaan",
                        "Sachin",
                        "Ved",
                        "Vikram",
                        "Sanjay",
                        "Rajah",
                        "Varun",
                        "Vijay",
                        "Darshan",
                        "Deepak",
                        "Pranav",
                        "Rajiv",
                        "Ranjit",
                        "Pradeep",
                        "Kumar"
                    ],
                    "femaleNames": [
                        "Veda",
                        "Priya",
                        "Indira",
                        "Reshma",
                        "Anjali",
                        "Sansa",
                        "Rani",
                        "Savita",
                        "Lakshmi",
                        "Neela",
                        "Meena",
                        "Reva",
                        "Chandra",
                        "Nayana",
                        "Anara",
                        "Padma",
                        "Parvati",
                        "Bala"
                    ]
                },
                {
                    "id": "chinese",
                    "maleNames": [
                        "Tai",
                        "Jun",
                        "Chang",
                        "Long",
                        "Chen",
                        "Yu",
                        "Ushi",
                        "Quon",
                        "Lin",
                        "Yan",
                        "Han",
                        "Cheng",
                        "Kwan",
                        "Jian",
                        "Sun",
                        "Jin"
                    ],
                    "femaleNames": [
                        "Mei",
                        "Xia",
                        "Xin",
                        "Min",
                        "Lian",
                        "Bao",
                        "Yinuo",
                        "Ye",
                        "Zhen",
                        "Baojin",
                        "Bai",
                        "Lue",
                        "Jia",
                        "Mei",
                        "Maelin"
                    ]
                },
                {
                    "id": "japanese",
                    "maleNames": [
                        "Hiroshi",
                        "Toshio",
                        "Kazuo",
                        "Akira",
                        "Masao",
                        "Kiyoshi",
                        "Takashi",
                        "Hideo",
                        "Koichi",
                        "Koji",
                        "Takeshi",
                        "Shoji",
                        "Hiroyuki",
                        "Shigeo",
                        "Susumu",
                        "Akio",
                        "Isamu",
                        "Masahiro",
                        "Shinichi",
                        "Osamu",
                        "Takeo",
                        "Yuji",
                        "Haruo",
                        "Kunio",
                        "Sadao",
                        "Seiichi",
                        "Satoshi"
                    ],
                    "femaleNames": [
                        "Honoka",
                        "Akari",
                        "Himari",
                        "Ichika",
                        "Sachiko",
                        "Katsumi",
                        "Yoko",
                        "Michiko",
                        "Hiromi",
                        "Yoshiko",
                        "Hiroko",
                        "Keiko",
                        "Fumiko",
                        "Reiko",
                        "Takako",
                        "Miyoko",
                        "Tomiko",
                        "Nobuko",
                        "Etsuko",
                        "Tomoko",
                        "Yuki",
                        "Kimie",
                        "Kaoru",
                        "Kiyomi",
                        "Maki"
                    ]
                }
            ],
            "maleRaceWeights": {
                "middle-eastern": 5,
                "south asian": 10,
                "white": 65,
                "black": 15,
                "east asian": 5
            },
            "femaleRaceWeights": {
                "middle-eastern": 5,
                "south asian": 10,
                "white": 65,
                "black": 15,
                "east asian": 5
            },
            "defaultNameList": "general"
        }

        // DOM elements
        const version = document.getElementById('version-select');

        const raceDataUpload = document.getElementById('raceDataUpload');
        const raceDataBrowse = document.getElementById('raceDataBrowseButton');
        const raceDataReset = document.getElementById('raceDataResetButton');
        const raceDataText = document.getElementById('raceDataText');
        const customRaceData = document.getElementById('customRaceData');
        let raceData = defaultRaceData

        const characterType = document.getElementById('character-type');
        const traitsContainer = document.getElementById('traits-container');
        const selectedTraitsContainer = document.getElementById('selected-traits');
        const blockedTraitsContainer = document.getElementById('blocked-traits-container');
        const selectedBlockedTraitsContainer = document.getElementById('selected-blocked-traits');
        const traitFilter = document.getElementById('trait-filter');
        const blockedTraitFilter = document.getElementById('blocked-trait-filter');

        const generateButton = document.getElementById('generate-button');
        const resetButton = document.getElementById('reset-button');

        const yamlOutput = document.getElementById('yaml-output');
        const copyButton = document.getElementById('copy-button');
        const downloadButton = document.getElementById('download-button');
        const backButton = document.getElementById('back-button');

        // Version handler
        version.addEventListener('change', updateTraitsForCharacterType);
        
        // Tab handling
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                button.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        raceDataReset.addEventListener('click', function() {
            raceDataText.value = '';
            raceDataBrowse.style.display = "inline"
            raceDataReset.style.display = "none"
            raceData = defaultRaceData
            updateRaceOptions(raceData.raceDefs);
        });

        // Race data change handler
        // Update filename display when file is selected
        raceDataUpload.addEventListener('change', function() {
            if (this.files.length == 0) {
                raceDataText.value = '';
                raceDataBrowse.style.display = "inline";
                raceDataReset.style.display = "none";
                return;
            }

            const file = this.files[0];

            if (!file) {
                raceDataText.value = '';
                raceDataBrowse.style.display = "inline";
                raceDataReset.style.display = "none";
                alert('Please select a JSON file first.');
                return;
            }

            if (!validateJsonFile(file)) {
                raceDataText.value = '';
                raceDataBrowse.style.display = "inline";
                raceDataReset.style.display = "none";
                return; // Stop if validation fails
            }

            raceDataBrowse.style.display = "none";
            raceDataReset.style.display = "inline";
            raceDataText.value = "Using custom " + file.name;

            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    raceData = JSON.parse(e.target.result);
                    
                    // Basic validation of the parsed data
                    if (!raceData.raceDefs || !Array.isArray(raceData.raceDefs)) {
                        throw new Error("Invalid JSON format: missing raceDefs array");
                    }
                    
                    // Process the data (update UI based on the loaded data)
                    displayJsonData(raceData);
                    
                    console.log('Successfully loaded JSON data:', raceData);
                } catch (error) {
                    console.error('Error parsing JSON:', error);
                    alert('Error loading JSON: ' + error.message);
                    
                    // Reset UI elements
                    raceDataText.value = '';
                    raceDataBrowse.style.display = "inline";
                    raceDataReset.style.display = "none";
                }
            };
            
            reader.onerror = function(error) {
                console.error('Error reading file:', error);
                alert('Error reading file');
                
                // Reset UI elements
                raceDataText.value = '';
                raceDataBrowse.style.display = "inline";
                raceDataReset.style.display = "none";
            };
            
            // Read the file as text
            reader.readAsText(file);
        });

        function validateJsonFile(file) {
            // Check file extension
            if (!file.name.toLowerCase().endsWith('.json')) {
                alert('Please select a JSON file (.json)');
                return false;
            }

            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                alert('File is too large. Maximum file size is 5MB.');
                return false;
            }
            
            // Check MIME type (though this can be unreliable)
            if (file.type && file.type !== 'application/json') {
                console.warn('File MIME type is not application/json, but continuing anyway');
            }
            
            return true;
        }

        // Display JSON data in the preview area
        function displayJsonData(raceData) {
            // customRaceData.textContent = JSON.stringify(raceData, null, 2);
            
            // Here you can also do something with the data
            // For example:
            processJsonData(raceData);
        }

        // Example function to process the JSON data
        function processJsonData(raceData) {
            // Access specific parts of the data
            if (raceData.raceDefs) {
                console.log(`Found ${raceData.raceDefs.length} race definitions`);
            }
            
            if (raceData.nameLists) {
                console.log(`Found ${raceData.nameLists.length} name lists`);
            }
            
            // You can process the data further as needed
            if (raceData.raceDefs && Array.isArray(raceData.raceDefs)) {
                // Update the race options based on the loaded data
                updateRaceOptions(raceData.raceDefs);
                console.log(`Found ${raceData.raceDefs.length} race definitions`);
            }
        }

        loadCharacterUpload.addEventListener('change', function() {
            if (this.files.length == 0) {
                loadCharacterText.value = '';
                return;
            }

            const file = this.files[0];

            if (!file) {
                loadCharacterText.value = '';
                alert('Please select a .yml file first.');
                return;
            }

            if (!validateYamlFile(file)) {
                loadCharacterText.value = "Failed to load " + file.name;
                return; // Stop if validation fails
            }

            const filenameWithoutExtension = file.name.split('.').slice(0, -1).join('.');
            loadCharacterText.value = filenameWithoutExtension;

            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                     // Use js-yaml to parse YAML content
                    const characterData = jsyaml.load(e.target.result);
                    
                    // Basic validation of the character data
                    if (!characterData || typeof characterData !== 'object') {
                        throw new Error("Invalid YAML format: could not parse character data");
                    }
                    
                    // Check for required fields - adjust based on your actual requirements
                    if (!characterData.name || !characterData.type) {
                        throw new Error("Invalid character data: missing required fields");
                    }
                    
                    // Process the data (update UI based on the loaded data)
                    updateCharacterData(characterData);
                    
                    //console.log('Successfully loaded YAML data: ', characterData);
                } catch (error) {
                    console.error('Error parsing YAML:', error);
                    alert('Error loading YAML: ' + error.message);
                    
                    // Reset UI elements
                    loadCharacterText.value = "Failed to load " + file.name;
                }
            };
            
            reader.onerror = function(error) {
                console.error('Error reading file:', error);
                alert('Error reading file');
                
                // Reset UI elements
                loadCharacterText.value = "Failed to load " + file.name;
            };
            
            // Read the file as text
            reader.readAsText(file);

        });

        function validateYamlFile(file) {
            // Check file extension
            if (!file.name.toLowerCase().endsWith('.yml')) {
                alert('Please select a .yml file (.yaml is not supported by Newlife)');
                return false;
            }

            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                alert('File is too large. Maximum file size is 5MB.');
                return false;
            }
            
            // Check MIME type (though this can be unreliable)
            // YAML files don't have a standardized MIME type, but often use text/yaml, application/yaml, or text/plain
            if (file.type && !['text/yaml', 'application/yaml', 'text/plain', 'application/x-yaml'].includes(file.type)) {
                console.warn('File MIME type is not a standard YAML type, but continuing anyway');
            }
            
            return true;
        }

        function updateCharacterData(characterData) {
            const yml_type = characterData.type ?? 'MALE';
            const yml_priority = characterData.priority ?? '0';
            const yml_name = characterData.name ?? '';
            const yml_characterType = characterData['character type'] ?? 'INNOCENT';
            const yml_clothingStyle = characterData['clothing style'] ?? 'CUTE';
            const yml_age = characterData.age ?? 'TWENTIES';
            const yml_namelistId = characterData.nameListId ?? '';
            const yml_race = characterData.race ?? '';
            const yml_eyeColour = characterData['eye colour'] ?? '';
            const yml_hairColour = characterData['hair colour'] ?? '';
            const yml_skinColour = characterData['skin colour'] ?? '';
            const yml_figure = characterData.figure ?? '';
            const yml_personality = characterData.personality ?? 'AVERAGE';
            const yml_breasts = characterData.breasts ?? '';
            const yml_virgin = characterData.virgin ?? '';
            const yml_lesbianVirgin = characterData['lesbian virgin'] ?? '';
            const yml_hairstyle = characterData.hairstyle ?? '';
            const yml_friendEffect = characterData['friend effect'] ?? '';
            const yml_partnerEffect = characterData['partner effect'] ?? '';
            const yml_bossPartnerEffect = characterData['boss partner effect'] ?? '';
            const yml_career = characterData.career ?? '';
            const yml_allowAdditionalTraits = characterData['allow additional traits'] ?? 'TRUE';
            const yml_traits = characterData.traits ?? [];
            const yml_blockedTraits = characterData['blocked traits'] ?? [];


            document.getElementById('character-type').value = yml_type;
            document.getElementById('character-priority').value = yml_priority;
            document.getElementById('character-name').value = yml_name;
            document.getElementById('character-type-female').value = yml_characterType;
            document.getElementById('clothing-style').value = yml_clothingStyle;
            document.getElementById('character-age').value = yml_age;
            document.getElementById('namelist-id').value = yml_namelistId;

            // Extract a list of all valid races from the raceData JSON
            const validRaces = raceData.raceDefs.map(raceDef => raceDef.race);
            if (yml_race === '' || validRaces.includes(yml_race)) {
                document.getElementById('character-race').value = yml_race;
                document.getElementById('custom-race').value = '';
                customRaceFields.style.display = 'none';
            } else {
                document.getElementById('character-race').value = 'custom';
                document.getElementById('custom-race').value = yml_race;
                customRaceFields.style.display = 'block';
            }

            document.getElementById('eye-colour').value = yml_eyeColour;
            document.getElementById('hair-colour').value = yml_hairColour;
            document.getElementById('skin-colour').value = yml_skinColour;

            if (yml_type === 'MALE') {
                document.getElementById('male-figure').value = yml_figure;
                document.getElementById('female-figure').value = '';
            } else {
                document.getElementById('male-figure').value = '';
                document.getElementById('female-figure').value = yml_figure;
            }

            document.getElementById('character-personality').value = yml_personality;
            document.getElementById('breast-size').value = yml_breasts;
            document.getElementById('female-virgin').value = String(yml_virgin).toUpperCase();
            document.getElementById('female-lesbian-virgin').value = String(yml_lesbianVirgin).toUpperCase();
            document.getElementById('hairstyle').value = yml_hairstyle;
            document.getElementById('friend-effect').value = yml_friendEffect;
            document.getElementById('partner-effect').value = yml_partnerEffect;
            document.getElementById('boss-partner-effect').value = yml_bossPartnerEffect;
            document.getElementById('career').value = yml_career;
            document.getElementById('allow-additional-traits').value = String(yml_allowAdditionalTraits).toUpperCase();
            
            // Reset trait cards
            const traitCards = document.querySelectorAll('.trait-card');
            traitCards.forEach(card => {
                card.classList.remove('selected');
                card.classList.remove('disabled');
            });

            selectedTraits = yml_traits;
            selectedBlockedTraits = yml_blockedTraits;
            
            updateSelectedTraits();
            updateSelectedBlockedTraits();
            updateTraitAvailability();
        }

        // Character type change handler
        characterType.addEventListener('change', updateTraitsForCharacterType);
        
        // Race selector
        const raceSelect = document.getElementById('character-race');
        const customRaceFields = document.getElementById('custom-race-fields');
        
        raceSelect.addEventListener('change', () => {
            if (raceSelect.value === 'custom') {
                customRaceFields.style.display = 'block';
            } else {
                customRaceFields.style.display = 'none';
            }

            updateAttributesByRace(raceSelect.value, raceData)
        });

        function updateRaceOptions(raceDefs) {            
            // Clear existing options (except the first "Random" option)
            while (raceSelect.options.length > 1) {
                raceSelect.remove(1);
            }
            
            // Add new options based on the raceDefs
            raceDefs.forEach(raceDef => {
                const option = document.createElement('option');
                option.value = raceDef.race;
                option.textContent = raceDef.race.replace(/\b[a-z]/g, char => char.toUpperCase());
                raceSelect.appendChild(option);
            });
            
            // Add the "custom" option at the end
            const customOption = document.createElement('option');
            customOption.value = "custom";
            customOption.textContent = "Custom (enter below)";
            raceSelect.appendChild(customOption);

            updateAttributesByRace(raceSelect.value, raceData)
        }

        function updateAttributesByRace(raceName, raceData) {
            updateAttributeOptions('eyeColours', raceName, raceData, 'eye-colour-list');
            updateAttributeOptions('hairColours', raceName, raceData, 'hair-colour-list');
            updateAttributeOptions('skinColours', raceName, raceData, 'skin-colour-list');
            updateNamelistSelect(raceName, raceData, 'namelist-id')
        }

        /**
         * Updates a datalist with attribute options based on selected race
         * @param {string} attributeType - The type of attribute ('eyeColours', 'hairColours', 'skinColours', etc.)
         * @param {string} raceName - The currently selected race
         * @param {Object} raceData - The full race data object
         * @param {string} datalistId - The HTML ID of the datalist to update
         */
        function updateAttributeOptions(attributeType, raceName, raceData, datalistId) {
            // Get the datalist element
            const datalist = document.getElementById(datalistId);
            
            // Get first and last option values from race dropdown
            const firstOptionValue = raceSelect.options[0].value;
            const lastOptionValue = raceSelect.options[raceSelect.options.length - 1].value;
            
            // Clear existing options
            datalist.innerHTML = '';
            
            // If race is random or custom, show all unique attribute values
            if (raceName === firstOptionValue || raceName === lastOptionValue) {
                // Get all unique attribute values across all races
                const allValues = new Set();
                
                raceData.raceDefs.forEach(raceDef => {
                    if (raceDef[attributeType] && Array.isArray(raceDef[attributeType])) {
                        raceDef[attributeType].forEach(value => allValues.add(value));
                    }
                });
                
                // Add each unique value to the datalist
                allValues.forEach(value => {
                    const option = document.createElement('option');
                    option.value = value.replace(/\b[a-z]/g, char => char.toUpperCase());
                    datalist.appendChild(option);
                });
            } 
            // Otherwise show only the attribute values for the selected race
            else {
                const raceDef = raceData.raceDefs.find(def => def.race === raceName);
                
                if (raceDef && raceDef[attributeType]) {
                    raceDef[attributeType].forEach(value => {
                        const option = document.createElement('option');
                        option.value = value.replace(/\b[a-z]/g, char => char.toUpperCase());
                        datalist.appendChild(option);
                    });
                }
            }
        }

        /**
         * Updates a namelist select element based on selected race
         * @param {string} raceName - The currently selected race
         * @param {Object} raceData - The full race data object
         * @param {string} selectId - The HTML ID of the select element to update
         */
         function updateNamelistSelect(raceName, raceData, selectId) {
            // Get the select element
            const selectElement = document.getElementById(selectId);
            
            // Store the current selected value before clearing options
            const currentSelectedValue = selectElement.value;
            
            // Get first and last option values from race dropdown
            const firstOptionValue = raceSelect.options[0].value;
            const lastOptionValue = raceSelect.options[raceSelect.options.length - 1].value;
            
            // Clear existing options
            selectElement.innerHTML = '';
            
            // Add a default "Random" option
            const randomOption = document.createElement('option');
            randomOption.value = '';
            randomOption.textContent = 'Random (based on race)';
            selectElement.appendChild(randomOption);
            
            // If race is random or custom, show all namelists without grouping
            if (raceName === firstOptionValue || raceName === lastOptionValue) {
                // Add all namelist IDs
                const allNamelistOptions = [];
                
                raceData.nameLists.forEach(nameList => {
                    if (nameList.id) {
                        allNamelistOptions.push({
                            id: nameList.id,
                            weight: 0
                        });
                    }
                });
                
                // Sort alphabetically
                allNamelistOptions.sort((a, b) => a.id.localeCompare(b.id));
                
                // Add all options
                allNamelistOptions.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.id;
                    optionElement.textContent = option.id.replace(/\b[a-z]/g, char => char.toUpperCase());
                    selectElement.appendChild(optionElement);
                });
            } 
            // Otherwise show associated and other namelists in separate groups
            else {
                const raceDef = raceData.raceDefs.find(def => def.race === raceName);
                
                if (raceDef && raceDef.nameLists) {
                    // Create associated namelists group
                    const associatedNames = Object.entries(raceDef.nameLists);
                    
                    if (associatedNames.length > 0) {
                        // Create an array of associated options
                        const associatedOptions = associatedNames.map(([id, weight]) => ({
                            id: id
                        }));
                        
                        // Sort alphabetically
                        associatedOptions.sort((a, b) => a.id.localeCompare(b.id));
                        
                        // Create an optgroup for associated namelists
                        const associatedGroup = document.createElement('optgroup');
                        associatedGroup.label = raceName.replace(/\b[a-z]/g, char => char.toUpperCase()) + " Namelists";
                        
                        // Add associated options to the group
                        associatedOptions.forEach(option => {
                            const optionElement = document.createElement('option');
                            optionElement.value = option.id;
                            optionElement.textContent = option.id.replace(/\b[a-z]/g, char => char.toUpperCase());
                            associatedGroup.appendChild(optionElement);
                        });
                        
                        // Add the associated group to the select
                        selectElement.appendChild(associatedGroup);
                        
                        // Create a set of associated namelist IDs for quick lookup
                        const associatedIds = new Set(Object.keys(raceDef.nameLists));
                        
                        // Get other namelists not associated with this race
                        const otherOptions = [];
                        raceData.nameLists.forEach(nameList => {
                            if (nameList.id && !associatedIds.has(nameList.id)) {
                                otherOptions.push({
                                    id: nameList.id
                                });
                            }
                        });
                        
                        // If there are other options, add them under a group
                        if (otherOptions.length > 0) {
                            // Sort other options alphabetically
                            otherOptions.sort((a, b) => a.id.localeCompare(b.id));
                            
                            // Create an optgroup for other namelists
                            const overrideGroup = document.createElement('optgroup');
                            overrideGroup.label = "Other Namelists";
                            
                            // Add other options to the group
                            otherOptions.forEach(option => {
                                const optionElement = document.createElement('option');
                                optionElement.value = option.id;
                                optionElement.textContent = option.id.replace(/\b[a-z]/g, char => char.toUpperCase());
                                overrideGroup.appendChild(optionElement);
                            });
                            
                            // Add the override group to the select
                            selectElement.appendChild(overrideGroup);
                        }
                    }
                }
            }
            
            // Restore previously selected value if it exists in the new options
            if (currentSelectedValue) {
                // Check if the value exists in the new options
                const optionExists = Array.from(selectElement.options).some(option => option.value === currentSelectedValue);
                
                if (optionExists) {
                    selectElement.value = currentSelectedValue;
                }
            }
        }
        
        // Collapsible sections
        const coll = document.getElementsByClassName("collapsible");
        
        for (let i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active-collapse");
                const content = this.nextElementSibling;
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                } else {
                    //content.style.maxHeight = content.scrollHeight + "px";
                    content.style.maxHeight = "fit-content";
                }
            });
        }

        // Parse version string into components
        function parseVersion(versionString) {
            // Split by dots and convert to numbers
            return versionString.split('.').map(Number);
        }

        // Compare two versions
        function compareVersions(version1, version2) {
            const v1 = parseVersion(version1);
            const v2 = parseVersion(version2);
            
            // Compare major version
            if (v1[0] !== v2[0]) return v1[0] - v2[0];
            
            // Compare minor version
            if (v1[1] !== v2[1]) return v1[1] - v2[1];
            
            // Compare patch version
            if (v1[2] !== v2[2]) return v1[2] - v2[2];
            
            // Versions are equal
            return 0;
        }

        // Selected traits and blocked traits
        let selectedTraits = [];
        let selectedBlockedTraits = [];

        function formatTraitName(trait) {
            return trait
                .replace(/_/g, ' ')                           // Replace underscores with spaces
                .toLowerCase()                                // Convert everything to lowercase
                .replace(/\b[a-z]/g, char => char.toUpperCase()); // Capitalize first letter of each word
        }
        
        // Update UI based on character type
        function updateTraitsForCharacterType() {
            const isMale = characterType.value === 'MALE';
            const femaleOnlyElements = document.querySelectorAll('.female-only');
            const maleOnlyElements = document.querySelectorAll('.male-only');
            const femaleEffects = document.querySelectorAll('.female-effect');
            const maleEffects = document.querySelectorAll('.male-effect');
            
            femaleOnlyElements.forEach(el => {
                el.style.display = isMale ? 'none' : 'block';
            });
            
            maleOnlyElements.forEach(el => {
                el.style.display = isMale ? 'block' : 'none';
            });
            
            // Hide/show gender-specific partner effects
            femaleEffects.forEach(option => {
                option.style.display = isMale ? 'none' : 'block';
            });
            
            maleEffects.forEach(option => {
                option.style.display = isMale ? 'block' : 'none';
            });
            
            // Clear and repopulate traits
            traitsContainer.innerHTML = '';
            blockedTraitsContainer.innerHTML = '';
            selectedTraits = [];
            selectedBlockedTraits = [];
            selectedTraitsContainer.innerHTML = '';
            selectedBlockedTraitsContainer.innerHTML = '';
            
            const traits = isMale ? maleTraits : femaleTraits;
            
            for (const [trait, info] of Object.entries(traits)) {

                //console.log("version:", info.version, " vs ", version.value, " is ", compareVersions(info.version, version.value) );
                if (compareVersions(info.version, version.value) > 0) continue;
                

                // Create trait card for selection
                const traitCard = document.createElement('div');
                traitCard.className = 'trait-card';
                traitCard.textContent = formatTraitName(trait);
                traitCard.setAttribute('data-trait', trait);
                
                // Add tooltip
                const tooltip = document.createElement('span');
                tooltip.className = 'tooltip';
                tooltip.textContent = info.description;
                traitCard.appendChild(tooltip);

                // Add mouseenter event listener for tooltip positioning
                traitCard.addEventListener('mouseenter', function(e) {
                    // Get the position of the trait card - FIXED: using traitCard instead of card
                    const rect = traitCard.getBoundingClientRect();
                    
                    // Position the tooltip above the card
                    tooltip.style.left = rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2) + 'px';
                    tooltip.style.top = rect.top - tooltip.offsetHeight - 5 + 'px';
                    
                    // Make sure tooltip stays in the viewport
                    const tooltipRect = tooltip.getBoundingClientRect();
                    
                    // Check if tooltip is going beyond left edge
                    if (tooltipRect.left < 0) {
                        tooltip.style.left = '5px';
                    }
                    
                    // Check if tooltip is going beyond right edge
                    if (tooltipRect.right > window.innerWidth) {
                        tooltip.style.left = (window.innerWidth - tooltipRect.width - 5) + 'px';
                    }
                });
                
                traitCard.addEventListener('click', () => {
                    if (traitCard.classList.contains('disabled')) return;
                    
                    if (traitCard.classList.contains('selected')) {
                        // Remove from selected
                        traitCard.classList.remove('selected');
                        selectedTraits = selectedTraits.filter(t => t !== trait);
                        updateSelectedTraits();
                        updateTraitAvailability();
                    } else {
                        // Add to selected
                        traitCard.classList.add('selected');
                        selectedTraits.push(trait);
                        updateSelectedTraits();
                        updateTraitAvailability();
                    }
                });
                
                traitsContainer.appendChild(traitCard);
                
                // Create blocked trait card
                const blockedTraitCard = document.createElement('div');
                blockedTraitCard.className = 'trait-card';
                blockedTraitCard.textContent = formatTraitName(trait);
                blockedTraitCard.setAttribute('data-trait', trait);
                
                // Add tooltip
                const blockedTooltip = document.createElement('span');
                blockedTooltip.className = 'tooltip';
                blockedTooltip.textContent = info.description;
                blockedTraitCard.appendChild(blockedTooltip);
                
                // Add mouseenter event listener for tooltip positioning - ADDED
                blockedTraitCard.addEventListener('mouseenter', function(e) {
                    // Get the position of the blocked trait card
                    const rect = blockedTraitCard.getBoundingClientRect();
                    
                    // Position the tooltip above the card
                    blockedTooltip.style.left = rect.left + (rect.width / 2) - (blockedTooltip.offsetWidth / 2) + 'px';
                    blockedTooltip.style.top = rect.top - blockedTooltip.offsetHeight - 5 + 'px';
                    
                    // Make sure tooltip stays in the viewport
                    const tooltipRect = blockedTooltip.getBoundingClientRect();
                    
                    // Check if tooltip is going beyond left edge
                    if (tooltipRect.left < 0) {
                        blockedTooltip.style.left = '5px';
                    }
                    
                    // Check if tooltip is going beyond right edge
                    if (tooltipRect.right > window.innerWidth) {
                        blockedTooltip.style.left = (window.innerWidth - tooltipRect.width - 5) + 'px';
                    }
                });
                
                blockedTraitCard.addEventListener('click', () => {
                    if (blockedTraitCard.classList.contains('disabled')) return;
                    
                    if (blockedTraitCard.classList.contains('selected')) {
                        // Remove from selected blocked
                        blockedTraitCard.classList.remove('selected');
                        selectedBlockedTraits = selectedBlockedTraits.filter(t => t !== trait);
                        updateSelectedBlockedTraits();
                    } else {
                        // Add to selected blocked
                        blockedTraitCard.classList.add('selected');
                        selectedBlockedTraits.push(trait);
                        updateSelectedBlockedTraits();
                    }
                });
                
                blockedTraitsContainer.appendChild(blockedTraitCard);
            }
            
            updateTraitAvailability();
        }
        
        // Filter traits
        traitFilter.addEventListener('input', filterTraits);
        blockedTraitFilter.addEventListener('input', filterBlockedTraits);
        
        function filterTraits() {
            const filter = traitFilter.value.toUpperCase();
            const traitCards = traitsContainer.querySelectorAll('.trait-card');
            
            traitCards.forEach(card => {
                const trait = card.getAttribute('data-trait');
                if (trait.toUpperCase().indexOf(filter) > -1) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        function filterBlockedTraits() {
            const filter = blockedTraitFilter.value.toUpperCase();
            const traitCards = blockedTraitsContainer.querySelectorAll('.trait-card');
            
            traitCards.forEach(card => {
                const trait = card.getAttribute('data-trait');
                if (trait.toUpperCase().indexOf(filter) > -1) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Update the display of selected traits
        function updateSelectedTraits() {
            selectedTraitsContainer.innerHTML = '';
            
            selectedTraits.forEach(trait => {
                const traitElement = document.createElement('div');
                traitElement.className = 'selected-trait';
                traitElement.innerHTML = `${formatTraitName(trait)} <span class="remove"></span>`;
                
                traitElement.querySelector('.remove').addEventListener('click', () => {
                    selectedTraits = selectedTraits.filter(t => t !== trait);
                    updateSelectedTraits();
                    
                    // Also deselect in the traits container
                    const traitCard = traitsContainer.querySelector(`[data-trait="${trait}"]`);
                    if (traitCard) {
                        traitCard.classList.remove('selected');
                    }
                    
                    updateTraitAvailability();
                    updateBlockedTraitAvailability();
                });
                
                selectedTraitsContainer.appendChild(traitElement);
            });

            let accordianText = "Traits"
            if (selectedTraits.length > 0) {accordianText += " (" + selectedTraits.length + ")"}
            document.getElementById('traits-accordian').textContent = accordianText;
            
            updateTraitAvailability();
            updateBlockedTraitAvailability();
        }
        
        // Update the display of selected blocked traits
        function updateSelectedBlockedTraits() {
            selectedBlockedTraitsContainer.innerHTML = '';
            
            selectedBlockedTraits.forEach(trait => {
                const traitElement = document.createElement('div');
                traitElement.className = 'selected-trait';
                traitElement.innerHTML = `${formatTraitName(trait)} <span class="remove"></span>`;
                
                traitElement.querySelector('.remove').addEventListener('click', () => {
                    selectedBlockedTraits = selectedBlockedTraits.filter(t => t !== trait);
                    updateSelectedBlockedTraits();
                    
                    // Also deselect in the blocked traits container
                    const traitCard = blockedTraitsContainer.querySelector(`[data-trait="${trait}"]`);
                    if (traitCard) {
                        traitCard.classList.remove('selected');
                    }

                    updateTraitAvailability();
                    updateBlockedTraitAvailability();
                });
                
                selectedBlockedTraitsContainer.appendChild(traitElement);
            });

            let accordianText = "Blocked Traits"
            if (selectedBlockedTraits.length > 0) {accordianText += " (" + selectedBlockedTraits.length + ")"}
            document.getElementById('blocked-traits-accordian').textContent = accordianText;
            
            updateTraitAvailability();
            updateBlockedTraitAvailability();
        }
        
        // Disable traits that are opposed to selected ones
        function updateTraitAvailability() {
            const isMale = characterType.value === 'MALE';
            const traits = isMale ? maleTraits : femaleTraits;
            
            // Get all trait cards
            const traitCards = traitsContainer.querySelectorAll('.trait-card');
            
            // First, enable all trait cards
            traitCards.forEach(card => {
                card.classList.remove('disabled');
            });
            
            // Then disable those that are opposed to selected traits
            selectedTraits.forEach(selectedTrait => {
                const opposites = traits[selectedTrait].opposites;
                
                opposites.forEach(opposite => {
                    const oppositeCard = traitsContainer.querySelector(`[data-trait="${opposite}"]`);
                    if (oppositeCard) {
                        oppositeCard.classList.add('disabled');
                    }
                });
            });

            // Also disable traits that are already blocked
            selectedBlockedTraits.forEach(blockedTrait => {
                const traitCard = traitsContainer.querySelector(`[data-trait="${blockedTrait}"]`);
                if (traitCard) {
                    traitCard.classList.add('disabled');
                }
            });
        }

        // Disable traits in the blocked traits container that are already selected
        function updateBlockedTraitAvailability() {
            // Get all blocked trait cards
            const blockedTraitCards = blockedTraitsContainer.querySelectorAll('.trait-card');
            
            // First, enable all blocked trait cards
            blockedTraitCards.forEach(card => {
                card.classList.remove('disabled');
            });
            
            // Then disable those that are already selected
            selectedTraits.forEach(selectedTrait => {
                const blockedTraitCard = blockedTraitsContainer.querySelector(`[data-trait="${selectedTrait}"]`);
                if (blockedTraitCard) {
                    blockedTraitCard.classList.add('disabled');
                }
            });
        }

        function capitalize(string) {
            if (!string) return '';
            return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();
        }
        
        // Generate YAML
        generateButton.addEventListener('click', generateYAML);

        function generateYAML() {
            const isMale = characterType.value === 'MALE';
            let yaml = '';
            
            yaml += '---\n';
            yaml += `type: ${characterType.value}\n`;
            yaml += `enabled: ${document.getElementById('character-enabled').value}\n`;
            
            const priority = document.getElementById('character-priority').value;
            yaml += `priority: ${priority}\n`;
            
            const name = capitalize(document.getElementById('character-name').value);
            // Always include the field, even if empty
            yaml += `name: ${name}\n`;
            
            if (!isMale) {
                const characterTypeFemale = document.getElementById('character-type-female').value;
                yaml += `character type: ${characterTypeFemale}\n`;
                
                const clothingStyle = document.getElementById('clothing-style').value;
                yaml += `clothing style: ${clothingStyle}\n`;
            }
            
            const age = document.getElementById('character-age').value;
            yaml += `age: ${age}\n`;
            
            const namelistId = document.getElementById('namelist-id').value;
            // Always include the field, even if empty
            yaml += `nameListId: ${namelistId}\n`;
            
            let race = document.getElementById('character-race').value;
            if (race === 'custom') {
                race = document.getElementById('custom-race').value;
            }
            // Always include race, even if empty
            yaml += `race: ${race}\n`;
            
            const eyeColour = document.getElementById('eye-colour').value;
            const hairColour = document.getElementById('hair-colour').value;
            const skinColour = document.getElementById('skin-colour').value;
            
            // Always include these fields, even if empty
            yaml += `eye colour: ${eyeColour}\n`;
            yaml += `hair colour: ${hairColour}\n`;
            yaml += `skin colour: ${skinColour}\n`;
            
            const bodyTypeId = isMale ? 'male-figure' : 'female-figure';
            const bodyType = document.getElementById(bodyTypeId).value;
            // Always include figure, even if empty
            yaml += `figure: ${bodyType}\n`;
            
            const personality = document.getElementById('character-personality').value;
            // Always include personality, even if empty
            yaml += `personality: ${personality}\n`;
            
            if (!isMale) {
                const breastSize = document.getElementById('breast-size').value;
                // Always include breasts, even if empty
                yaml += `breasts: ${breastSize}\n`;
                
                const virgin = document.getElementById('female-virgin').value;
                // Always include virgin, even if empty
                yaml += `virgin: ${virgin}\n`;
                
                const lesbianVirgin = document.getElementById('female-lesbian-virgin').value;
                // Always include lesbian virgin, even if empty
                yaml += `lesbian virgin: ${lesbianVirgin}\n`;
            }
            
            if (selectedTraits.length > 0) {
                yaml += 'traits:\n';
                selectedTraits.forEach(trait => {
                    yaml += ` - ${trait}\n`;
                });
            } else {
                // Include empty traits section
                yaml += 'traits:\n';
            }
            
            const allowAdditionalTraits = document.getElementById('allow-additional-traits').value;
            yaml += `allow additional traits: ${allowAdditionalTraits}\n`;
            
            if (selectedBlockedTraits.length > 0) {
                yaml += 'blocked traits:\n';
                selectedBlockedTraits.forEach(trait => {
                    yaml += ` - ${trait}\n`;
                });
            } else {
                // Include empty blocked traits section
                yaml += 'blocked traits:\n';
            }
            
            const hairstyle = document.getElementById('hairstyle').value;
            // Always include hairstyle, even if empty
            yaml += `hairstyle: ${hairstyle}\n`;
            
            const friendEffect = document.getElementById('friend-effect').value;
            // Always include friend effect, even if empty
            yaml += `friend effect: ${friendEffect}\n`;
            
            const partnerEffect = document.getElementById('partner-effect').value;
            // Always include partner effect, even if empty
            yaml += `partner effect: ${partnerEffect}\n`;
            
            const bossPartnerEffect = document.getElementById('boss-partner-effect').value;
            // Always include boss partner effect, even if empty
            yaml += `boss partner effect: ${bossPartnerEffect}\n`;
            
            const career = document.getElementById('career').value;
            // Always include career, even if empty
            yaml += `career: ${career}\n`;
            
            yamlOutput.value = yaml;
            
            // Switch to output tab
            document.querySelector('[data-tab="tab-output"]').click();
        }
        
        // Copy to clipboard
        copyButton.addEventListener('click', () => {
            yamlOutput.select();
            document.execCommand('copy');
            copyButton.textContent = 'Copied!';
            
            setTimeout(() => {
                copyButton.textContent = 'Copy to Clipboard';
            }, 2000);
        });

        // Download yaml
        downloadButton.addEventListener('click', () => {
            // Create a Blob with the content
            const blob = new Blob([yamlOutput.value], { type: 'application/x-yaml' });
            
            // Create a URL for the Blob
            const url = URL.createObjectURL(blob);

            // Create a temporary anchor element
            const a = document.createElement('a');
            const name = document.getElementById('character-name').value;
            if (name == '') name = "newlife-character"

            a.href = url;
            a.download = name + '.yml'; // Set the filename
            
            // Append to the body, click it, and remove it
            document.body.appendChild(a);
            a.click();
            
            // Clean up
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 0);
        });
        
        // Back to editor
        backButton.addEventListener('click', () => {
            document.querySelector('[data-tab="tab-create"]').click();
        });
        
        // Reset form
        resetButton.addEventListener('click', () => {
            if (confirm('Are you sure you want to reset the form? All your selections will be lost.')) {
                document.getElementById('loadCharacterText').value = '';
                document.getElementById('character-type').value = 'MALE';
                document.getElementById('character-priority').value = '0';
                document.getElementById('character-name').value = '';
                document.getElementById('character-type-female').value = 'INNOCENT';
                document.getElementById('clothing-style').value = 'CUTE';
                document.getElementById('character-age').value = 'TWENTIES';
                document.getElementById('namelist-id').value = '';
                document.getElementById('character-race').value = '';
                document.getElementById('custom-race').value = '';
                document.getElementById('eye-colour').value = '';
                document.getElementById('hair-colour').value = '';
                document.getElementById('skin-colour').value = '';
                document.getElementById('male-figure').value = '';
                document.getElementById('female-figure').value = '';
                document.getElementById('character-personality').value = 'AVERAGE';
                document.getElementById('breast-size').value = '';
                document.getElementById('female-virgin').value = '';
                document.getElementById('female-lesbian-virgin').value = '';
                document.getElementById('hairstyle').value = '';
                document.getElementById('friend-effect').value = '';
                document.getElementById('partner-effect').value = '';
                document.getElementById('boss-partner-effect').value = '';
                document.getElementById('career').value = '';
                document.getElementById('allow-additional-traits').value = 'TRUE';
                
                selectedTraits = [];
                selectedBlockedTraits = [];
                customRaceFields.style.display = 'none';
                
                // Reset trait cards
                const traitCards = document.querySelectorAll('.trait-card');
                traitCards.forEach(card => {
                    card.classList.remove('selected');
                    card.classList.remove('disabled');
                });
                
                updateSelectedTraits();
                updateSelectedBlockedTraits();
                updateTraitsForCharacterType();
            }
        });
        
        // Load default race data
        raceDataText.value = '';
        raceDataBrowse.style.display = "inline"
        raceDataReset.style.display = "none"
        raceData = defaultRaceData
        updateRaceOptions(raceData.raceDefs);

        // Initialize the form
        updateTraitsForCharacterType();
        
        // Open trait section by default
        document.getElementsByClassName("faq")[0].click();
        document.getElementsByClassName("faq")[1].click(); // this is horrible lol
        document.getElementById("traits-accordian").click(); 

        // Get all trait cards
        const traitCards = document.querySelectorAll('.trait-card');
    </script>
</body>
</html>
